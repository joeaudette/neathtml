<?xml version="1.0" encoding="UTF-8"?>
<office:document xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:config="urn:oasis:names:tc:opendocument:xmlns:config:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" office:version="1.0" office:mimetype="application/vnd.oasis.opendocument.text">
<office:meta>
<meta:generator>OpenOffice.org/2.3$Linux OpenOffice.org_project/680m6$Build-9226</meta:generator>
<dc:title>Fighting Cross Site Scripting (XSS) with Some Javascript Judo</dc:title>
<meta:creation-date>2007-09-14T11:03:22</meta:creation-date>
<dc:creator>Dean Brettle</dc:creator>
<dc:date>2008-02-23T13:37:08</dc:date>
<meta:printed-by>Dean Brettle</meta:printed-by>
<meta:print-date>2007-09-24T08:51:38</meta:print-date>
<meta:editing-cycles>105</meta:editing-cycles>
<meta:editing-duration>P10DT3H3M34S</meta:editing-duration>
<meta:user-defined meta:name="Info 1"/>
<meta:user-defined meta:name="Info 2"/>
<meta:user-defined meta:name="Info 3"/>
<meta:user-defined meta:name="Info 4"/>
<meta:document-statistic meta:table-count="1" meta:image-count="0" meta:object-count="0" meta:page-count="19" meta:paragraph-count="235" meta:word-count="7841" meta:character-count="53814"/>
</office:meta>
<office:settings>
<config:config-item-set config:name="ooo:view-settings">
<config:config-item config:name="ViewAreaTop" config:type="int">323215</config:config-item>
<config:config-item config:name="ViewAreaLeft" config:type="int">-4524</config:config-item>
<config:config-item config:name="ViewAreaWidth" config:type="int">32625</config:config-item>
<config:config-item config:name="ViewAreaHeight" config:type="int">15030</config:config-item>
<config:config-item config:name="ShowRedlineChanges" config:type="boolean">false</config:config-item>
<config:config-item config:name="InBrowseMode" config:type="boolean">false</config:config-item>
<config:config-item-map-indexed config:name="Views">
<config:config-item-map-entry>
<config:config-item config:name="ViewId" config:type="string">view2</config:config-item>
<config:config-item config:name="ViewLeft" config:type="int">4122</config:config-item>
<config:config-item config:name="ViewTop" config:type="int">331461</config:config-item>
<config:config-item config:name="VisibleLeft" config:type="int">-4524</config:config-item>
<config:config-item config:name="VisibleTop" config:type="int">323215</config:config-item>
<config:config-item config:name="VisibleRight" config:type="int">28099</config:config-item>
<config:config-item config:name="VisibleBottom" config:type="int">338243</config:config-item>
<config:config-item config:name="ZoomType" config:type="short">0</config:config-item>
<config:config-item config:name="ZoomFactor" config:type="short">100</config:config-item>
<config:config-item config:name="IsSelectedFrame" config:type="boolean">false</config:config-item>
</config:config-item-map-entry>
</config:config-item-map-indexed>
</config:config-item-set>
<config:config-item-set config:name="ooo:configuration-settings">
<config:config-item config:name="AddParaTableSpacing" config:type="boolean">true</config:config-item>
<config:config-item config:name="PrintReversed" config:type="boolean">false</config:config-item>
<config:config-item config:name="OutlineLevelYieldsNumbering" config:type="boolean">false</config:config-item>
<config:config-item config:name="LinkUpdateMode" config:type="short">1</config:config-item>
<config:config-item config:name="PrintEmptyPages" config:type="boolean">true</config:config-item>
<config:config-item config:name="IgnoreFirstLineIndentInNumbering" config:type="boolean">false</config:config-item>
<config:config-item config:name="CharacterCompressionType" config:type="short">0</config:config-item>
<config:config-item config:name="PrintSingleJobs" config:type="boolean">false</config:config-item>
<config:config-item config:name="UpdateFromTemplate" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintPaperFromSetup" config:type="boolean">false</config:config-item>
<config:config-item config:name="AddFrameOffsets" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintLeftPages" config:type="boolean">true</config:config-item>
<config:config-item config:name="RedlineProtectionKey" config:type="base64Binary"/>
<config:config-item config:name="PrintTables" config:type="boolean">true</config:config-item>
<config:config-item config:name="ChartAutoUpdate" config:type="boolean">true</config:config-item>
<config:config-item config:name="PrintControls" config:type="boolean">true</config:config-item>
<config:config-item config:name="PrinterSetup" config:type="base64Binary">aAH+/09mZmljZWpldF81NjAwX3Nlcmllc19idwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQ1VQUzpPZmZpY2VqZXRfNTYwMF9zZXJpZXNfYncAAAAWAAMArgAAAAAAAAAFAFZUAAAkbQAASm9iRGF0YSAxCnByaW50ZXI9T2ZmaWNlamV0XzU2MDBfc2VyaWVzX2J3Cm9yaWVudGF0aW9uPVBvcnRyYWl0CmNvcGllcz0xCmN1cHM9MAptYXJnaW5kYWp1c3RtZW50PTAsMCwwLDAKY29sb3JkZXB0aD0yNApwc2xldmVsPTAKY29sb3JkZXZpY2U9MApQUERDb250ZXhEYXRhClBhZ2VTaXplOkxldHRlcgAA</config:config-item>
<config:config-item config:name="IgnoreTabsAndBlanksForLineCalculation" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintAnnotationMode" config:type="short">0</config:config-item>
<config:config-item config:name="LoadReadonly" config:type="boolean">false</config:config-item>
<config:config-item config:name="AddParaSpacingToTableCells" config:type="boolean">true</config:config-item>
<config:config-item config:name="AddExternalLeading" config:type="boolean">true</config:config-item>
<config:config-item config:name="ApplyUserData" config:type="boolean">true</config:config-item>
<config:config-item config:name="FieldAutoUpdate" config:type="boolean">true</config:config-item>
<config:config-item config:name="SaveVersionOnClose" config:type="boolean">false</config:config-item>
<config:config-item config:name="SaveGlobalDocumentLinks" config:type="boolean">false</config:config-item>
<config:config-item config:name="IsKernAsianPunctuation" config:type="boolean">false</config:config-item>
<config:config-item config:name="AlignTabStopPosition" config:type="boolean">true</config:config-item>
<config:config-item config:name="ClipAsCharacterAnchoredWriterFlyFrames" config:type="boolean">false</config:config-item>
<config:config-item config:name="CurrentDatabaseDataSource" config:type="string"/>
<config:config-item config:name="DoNotCaptureDrawObjsOnPage" config:type="boolean">false</config:config-item>
<config:config-item config:name="TableRowKeep" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrinterName" config:type="string">Officejet_5600_series_bw</config:config-item>
<config:config-item config:name="PrintFaxName" config:type="string"/>
<config:config-item config:name="ConsiderTextWrapOnObjPos" config:type="boolean">false</config:config-item>
<config:config-item config:name="UseOldPrinterMetrics" config:type="boolean">true</config:config-item>
<config:config-item config:name="PrintRightPages" config:type="boolean">true</config:config-item>
<config:config-item config:name="IsLabelDocument" config:type="boolean">false</config:config-item>
<config:config-item config:name="UseFormerLineSpacing" config:type="boolean">false</config:config-item>
<config:config-item config:name="AddParaTableSpacingAtStart" config:type="boolean">true</config:config-item>
<config:config-item config:name="UseFormerTextWrapping" config:type="boolean">false</config:config-item>
<config:config-item config:name="DoNotResetParaAttrsForNumFont" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintProspect" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintGraphics" config:type="boolean">true</config:config-item>
<config:config-item config:name="AllowPrintJobCancel" config:type="boolean">true</config:config-item>
<config:config-item config:name="CurrentDatabaseCommandType" config:type="int">0</config:config-item>
<config:config-item config:name="DoNotJustifyLinesWithManualBreak" config:type="boolean">false</config:config-item>
<config:config-item config:name="UseFormerObjectPositioning" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrinterIndependentLayout" config:type="string">high-resolution</config:config-item>
<config:config-item config:name="UseOldNumbering" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintPageBackground" config:type="boolean">true</config:config-item>
<config:config-item config:name="CurrentDatabaseCommand" config:type="string"/>
<config:config-item config:name="PrintDrawings" config:type="boolean">true</config:config-item>
<config:config-item config:name="PrintBlackFonts" config:type="boolean">false</config:config-item>
<config:config-item config:name="UnxForceZeroExtLeading" config:type="boolean">true</config:config-item>
</config:config-item-set>
</office:settings>
<office:scripts>
<office:script script:language="ooo:Basic">
<ooo:libraries>
<ooo:library-embedded ooo:name="Standard"/>
</ooo:libraries>
</office:script>
</office:scripts>
<office:font-face-decls>
<style:font-face style:name="StarSymbol" svg:font-family="StarSymbol"/>
<style:font-face style:name="Nimbus Mono L" svg:font-family="'Nimbus Mono L'" style:font-family-generic="modern" style:font-pitch="fixed"/>
<style:font-face style:name="Arial Unicode MS" svg:font-family="'Arial Unicode MS'" style:font-pitch="variable"/>
<style:font-face style:name="HG Mincho Light J" svg:font-family="'HG Mincho Light J'" style:font-pitch="variable"/>
<style:font-face style:name="Nimbus Roman No9 L" svg:font-family="'Nimbus Roman No9 L'" style:font-family-generic="roman" style:font-pitch="variable"/>
<style:font-face style:name="Thorndale" svg:font-family="Thorndale" style:font-family-generic="roman" style:font-pitch="variable"/>
<style:font-face style:name="Albany" svg:font-family="Albany" style:font-family-generic="swiss" style:font-pitch="variable"/>
<style:font-face style:name="DejaVu LGC Sans" svg:font-family="'DejaVu LGC Sans'" style:font-family-generic="system" style:font-pitch="variable"/>
</office:font-face-decls>
<office:styles>
<style:default-style style:family="graphic">
<style:graphic-properties draw:shadow-offset-x="0.1181in" draw:shadow-offset-y="0.1181in" draw:start-line-spacing-horizontal="0.1114in" draw:start-line-spacing-vertical="0.1114in" draw:end-line-spacing-horizontal="0.1114in" draw:end-line-spacing-vertical="0.1114in" style:flow-with-text="true"/>
<style:paragraph-properties style:text-autospace="ideograph-alpha" style:line-break="strict" style:writing-mode="lr-tb" style:font-independent-line-spacing="false">
<style:tab-stops/>
</style:paragraph-properties>
<style:text-properties style:use-window-font-color="true" fo:font-size="12pt" fo:language="en" fo:country="US" style:letter-kerning="true" style:font-size-asian="12pt" style:language-asian="en" style:country-asian="US" style:font-size-complex="12pt" style:language-complex="en" style:country-complex="US"/>
</style:default-style>
<style:default-style style:family="paragraph">
<style:paragraph-properties fo:hyphenation-ladder-count="no-limit" style:text-autospace="ideograph-alpha" style:punctuation-wrap="hanging" style:line-break="strict" style:tab-stop-distance="0.4925in" style:writing-mode="page"/>
<style:text-properties style:use-window-font-color="true" style:font-name="Nimbus Roman No9 L" fo:font-size="12pt" fo:language="en" fo:country="US" style:letter-kerning="true" style:font-name-asian="DejaVu LGC Sans" style:font-size-asian="12pt" style:language-asian="en" style:country-asian="US" style:font-name-complex="DejaVu LGC Sans" style:font-size-complex="12pt" style:language-complex="en" style:country-complex="US" fo:hyphenate="false" fo:hyphenation-remain-char-count="2" fo:hyphenation-push-char-count="2"/>
</style:default-style>
<style:default-style style:family="table">
<style:table-properties table:border-model="collapsing"/>
</style:default-style>
<style:default-style style:family="table-row">
<style:table-row-properties fo:keep-together="auto"/>
</style:default-style>
<style:style style:name="Standard" style:family="paragraph" style:class="text">
<style:paragraph-properties fo:margin-top="0.1in" fo:margin-bottom="0.1in"/>
</style:style>
<style:style style:name="Heading" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Text_20_body" style:auto-update="true" style:class="text">
<style:paragraph-properties fo:margin-top="0.1665in" fo:margin-bottom="0.1965in" fo:keep-with-next="always"/>
<style:text-properties style:font-name="Albany" fo:font-size="14pt" style:font-name-asian="HG Mincho Light J" style:font-size-asian="14pt" style:font-name-complex="Arial Unicode MS" style:font-size-complex="14pt"/>
</style:style>
<style:style style:name="Text_20_body" style:display-name="Text body" style:family="paragraph" style:parent-style-name="Standard" style:class="text"/>
<style:style style:name="List" style:family="paragraph" style:parent-style-name="Text_20_body" style:class="list"/>
<style:style style:name="Caption" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
<style:paragraph-properties fo:margin-top="0.0835in" fo:margin-bottom="0.0835in" text:number-lines="false" text:line-number="0"/>
<style:text-properties fo:font-size="12pt" fo:font-style="italic" style:font-size-asian="12pt" style:font-style-asian="italic" style:font-size-complex="12pt" style:font-style-complex="italic"/>
</style:style>
<style:style style:name="Index" style:family="paragraph" style:parent-style-name="Standard" style:class="index">
<style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0in" text:number-lines="false" text:line-number="0"/>
</style:style>
<style:style style:name="Signature" style:family="paragraph" style:parent-style-name="Standard" style:class="text">
<style:paragraph-properties text:number-lines="false" text:line-number="0"/>
</style:style>
<style:style style:name="Heading_20_1" style:display-name="Heading 1" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text" style:default-outline-level="1">
<style:text-properties style:font-name="Thorndale" fo:font-size="24pt" fo:font-weight="bold" style:font-name-asian="HG Mincho Light J" style:font-size-asian="24pt" style:font-weight-asian="bold" style:font-name-complex="Arial Unicode MS" style:font-size-complex="24pt" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Heading_20_2" style:display-name="Heading 2" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:auto-update="true" style:class="text" style:default-outline-level="2">
<style:text-properties style:font-name="Nimbus Roman No9 L" fo:font-size="18pt" fo:font-weight="bold" style:font-name-asian="DejaVu LGC Sans" style:font-size-asian="18pt" style:font-weight-asian="bold" style:font-name-complex="DejaVu LGC Sans" style:font-size-complex="18pt" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Heading_20_3" style:display-name="Heading 3" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text" style:default-outline-level="3">
<style:text-properties style:font-name="Nimbus Roman No9 L" fo:font-size="14pt" fo:font-weight="bold" style:font-name-asian="DejaVu LGC Sans" style:font-size-asian="14pt" style:font-weight-asian="bold" style:font-name-complex="DejaVu LGC Sans" style:font-size-complex="14pt" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Heading_20_4" style:display-name="Heading 4" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text" style:default-outline-level="4">
<style:text-properties fo:font-size="85%" fo:font-style="italic" fo:font-weight="bold" style:font-size-asian="85%" style:font-style-asian="italic" style:font-weight-asian="bold" style:font-size-complex="85%" style:font-style-complex="italic" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Heading_20_5" style:display-name="Heading 5" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text" style:default-outline-level="5">
<style:text-properties fo:font-size="85%" fo:font-weight="bold" style:font-size-asian="85%" style:font-weight-asian="bold" style:font-size-complex="85%" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Heading_20_6" style:display-name="Heading 6" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text" style:default-outline-level="6">
<style:text-properties fo:font-size="75%" fo:font-weight="bold" style:font-size-asian="75%" style:font-weight-asian="bold" style:font-size-complex="75%" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Numbering_20_1_20_Start" style:display-name="Numbering 1 Start" style:family="paragraph" style:parent-style-name="List" style:class="list">
<style:paragraph-properties fo:margin-left="0.25in" fo:margin-right="0in" fo:margin-top="0.1665in" fo:margin-bottom="0.0835in" fo:text-indent="-0.25in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="Numbering_20_1" style:display-name="Numbering 1" style:family="paragraph" style:parent-style-name="List" style:class="list">
<style:paragraph-properties fo:margin-left="0.25in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0.0835in" fo:text-indent="-0.25in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="Numbering_20_2" style:display-name="Numbering 2" style:family="paragraph" style:parent-style-name="List" style:class="list">
<style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0.0835in" fo:text-indent="-0.25in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="List_20_1" style:display-name="List 1" style:family="paragraph" style:parent-style-name="List" style:class="list">
<style:paragraph-properties fo:margin-left="0.25in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0.0835in" fo:text-indent="-0.25in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="List_20_2_20_Start" style:display-name="List 2 Start" style:family="paragraph" style:parent-style-name="List" style:class="list">
<style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:margin-top="0.1665in" fo:margin-bottom="0.0835in" fo:text-indent="-0.25in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="List_20_2" style:display-name="List 2" style:family="paragraph" style:parent-style-name="List" style:class="list">
<style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0.0835in" fo:text-indent="-0.25in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="List_20_3" style:display-name="List 3" style:family="paragraph" style:parent-style-name="List" style:class="list">
<style:paragraph-properties fo:margin-left="0.75in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0.0835in" fo:text-indent="-0.25in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="Header" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
<style:paragraph-properties text:number-lines="false" text:line-number="0">
<style:tab-stops>
<style:tab-stop style:position="3.3457in" style:type="center"/>
<style:tab-stop style:position="6.6925in" style:type="right"/>
</style:tab-stops>
</style:paragraph-properties>
</style:style>
<style:style style:name="Footer" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
<style:paragraph-properties text:number-lines="false" text:line-number="0">
<style:tab-stops>
<style:tab-stop style:position="3.3457in" style:type="center"/>
<style:tab-stop style:position="6.6925in" style:type="right"/>
</style:tab-stops>
</style:paragraph-properties>
</style:style>
<style:style style:name="Table_20_Contents" style:display-name="Table Contents" style:family="paragraph" style:parent-style-name="Text_20_body" style:class="extra"/>
<style:style style:name="Table_20_Heading" style:display-name="Table Heading" style:family="paragraph" style:parent-style-name="Table_20_Contents" style:class="extra">
<style:paragraph-properties fo:text-align="center" style:justify-single-word="false" text:number-lines="false" text:line-number="0"/>
<style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Footnote" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
<style:paragraph-properties fo:margin-left="0.1965in" fo:margin-right="0in" fo:text-indent="-0.1965in" style:auto-text-indent="false" text:number-lines="false" text:line-number="0"/>
<style:text-properties fo:font-size="10pt" style:font-size-asian="10pt" style:font-size-complex="10pt"/>
</style:style>
<style:style style:name="Sender" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
<style:text-properties fo:font-style="italic"/>
</style:style>
<style:style style:name="Contents_20_Heading" style:display-name="Contents Heading" style:family="paragraph" style:parent-style-name="Heading" style:class="index">
<style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false" text:number-lines="false" text:line-number="0"/>
<style:text-properties fo:font-size="16pt" fo:font-weight="bold" style:font-size-asian="16pt" style:font-weight-asian="bold" style:font-size-complex="16pt" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Contents_20_1" style:display-name="Contents 1" style:family="paragraph" style:parent-style-name="Index" style:class="index">
<style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
<style:tab-stops>
<style:tab-stop style:position="6in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
</style:tab-stops>
</style:paragraph-properties>
</style:style>
<style:style style:name="Contents_20_2" style:display-name="Contents 2" style:family="paragraph" style:parent-style-name="Index" style:class="index">
<style:paragraph-properties fo:margin-left="0.1965in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
<style:tab-stops>
<style:tab-stop style:position="5.8035in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
</style:tab-stops>
</style:paragraph-properties>
</style:style>
<style:style style:name="Contents_20_3" style:display-name="Contents 3" style:family="paragraph" style:parent-style-name="Index" style:class="index">
<style:paragraph-properties fo:margin-left="0.3929in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
<style:tab-stops>
<style:tab-stop style:position="5.6071in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
</style:tab-stops>
</style:paragraph-properties>
</style:style>
<style:style style:name="Contents_20_4" style:display-name="Contents 4" style:family="paragraph" style:parent-style-name="Index" style:class="index">
<style:paragraph-properties fo:margin-left="0.5898in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
<style:tab-stops>
<style:tab-stop style:position="5.4102in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
</style:tab-stops>
</style:paragraph-properties>
</style:style>
<style:style style:name="Contents_20_5" style:display-name="Contents 5" style:family="paragraph" style:parent-style-name="Index" style:class="index">
<style:paragraph-properties fo:margin-left="0.7862in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false">
<style:tab-stops>
<style:tab-stop style:position="5.2138in" style:type="right" style:leader-style="dotted" style:leader-text="."/>
</style:tab-stops>
</style:paragraph-properties>
</style:style>
<style:style style:name="Title" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Subtitle" style:class="chapter">
<style:paragraph-properties fo:text-align="center" style:justify-single-word="false"/>
<style:text-properties fo:font-size="18pt" fo:font-weight="bold" style:font-size-asian="18pt" style:font-weight-asian="bold" style:font-size-complex="18pt" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Subtitle" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="chapter" style:master-page-name="">
<style:paragraph-properties fo:text-align="center" style:justify-single-word="false" style:page-number="auto"/>
<style:text-properties fo:font-size="12pt" fo:font-style="italic" style:font-size-asian="14pt" style:font-style-asian="italic" style:font-size-complex="14pt" style:font-style-complex="italic"/>
</style:style>
<style:style style:name="Preformatted_20_Text" style:display-name="Preformatted Text" style:family="paragraph" style:parent-style-name="Standard" style:class="html">
<style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0in"/>
<style:text-properties style:font-name="Nimbus Mono L" fo:font-size="10pt" style:font-name-asian="Nimbus Mono L" style:font-size-asian="10pt" style:font-name-complex="Nimbus Mono L" style:font-size-complex="10pt"/>
</style:style>
<style:style style:name="Horizontal_20_Line" style:display-name="Horizontal Line" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Text_20_body" style:class="html">
<style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0.1965in" style:border-line-width-bottom="0.0008in 0.0138in 0.0008in" fo:padding="0in" fo:border-left="none" fo:border-right="none" fo:border-top="none" fo:border-bottom="0.0154in double #808080"/>
<style:text-properties fo:font-size="6pt"/>
</style:style>
<style:style style:name="List_20_Contents" style:display-name="List Contents" style:family="paragraph" style:parent-style-name="Standard" style:list-style-name="List_20_1" style:class="html" style:master-page-name="">
<style:paragraph-properties fo:margin-left="0.3937in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0in" fo:text-indent="0in" style:auto-text-indent="false" style:page-number="auto"/>
</style:style>
<style:style style:name="List_20_Heading" style:display-name="List Heading" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="List_20_Contents" style:class="html">
<style:paragraph-properties fo:margin-left="0in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="CodeExample" style:family="paragraph" style:parent-style-name="Preformatted_20_Text" style:master-page-name="">
<style:paragraph-properties fo:margin-left="0.5in" fo:margin-right="0in" fo:keep-together="always" fo:text-indent="0in" style:auto-text-indent="false" style:page-number="auto" fo:background-color="#e6e6e6">
<style:background-image/>
</style:paragraph-properties>
</style:style>
<style:style style:name="Bulleted_20_List" style:display-name="Bulleted List" style:family="paragraph" style:parent-style-name="List_20_2" style:list-style-name="Bulleted_20_List" style:class="list">
<style:paragraph-properties fo:margin-left="0.25in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="Numbered_20_List" style:display-name="Numbered List" style:family="paragraph" style:parent-style-name="Numbering_20_2" style:list-style-name="Numbered_20_List" style:class="list">
<style:paragraph-properties fo:margin-left="0.25in" fo:margin-right="0in" fo:text-indent="0in" style:auto-text-indent="false"/>
</style:style>
<style:style style:name="Footnote_20_Symbol" style:display-name="Footnote Symbol" style:family="text"/>
<style:style style:name="Numbering_20_Symbols" style:display-name="Numbering Symbols" style:family="text"/>
<style:style style:name="Bullet_20_Symbols" style:display-name="Bullet Symbols" style:family="text">
<style:text-properties style:font-name="StarSymbol" fo:font-size="9pt" style:font-name-asian="StarSymbol" style:font-size-asian="9pt" style:font-name-complex="StarSymbol" style:font-size-complex="9pt"/>
</style:style>
<style:style style:name="Internet_20_link" style:display-name="Internet link" style:family="text">
<style:text-properties fo:color="#000080" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/>
</style:style>
<style:style style:name="Visited_20_Internet_20_Link" style:display-name="Visited Internet Link" style:family="text">
<style:text-properties fo:color="#800000" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/>
</style:style>
<style:style style:name="Endnote_20_Symbol" style:display-name="Endnote Symbol" style:family="text"/>
<style:style style:name="Footnote_20_anchor" style:display-name="Footnote anchor" style:family="text">
<style:text-properties style:text-position="super 58%"/>
</style:style>
<style:style style:name="Emphasis" style:family="text">
<style:text-properties fo:font-style="italic" style:font-style-asian="italic" style:font-style-complex="italic"/>
</style:style>
<style:style style:name="Source_20_Text" style:display-name="Source Text" style:family="text">
<style:text-properties style:font-name="Nimbus Mono L" style:font-name-asian="Nimbus Mono L" style:font-name-complex="Nimbus Mono L"/>
</style:style>
<style:style style:name="Example" style:family="text">
<style:text-properties style:font-name="Nimbus Mono L" style:font-name-asian="Nimbus Mono L" style:font-name-complex="Nimbus Mono L"/>
</style:style>
<style:style style:name="Variable" style:family="text">
<style:text-properties fo:font-style="italic" style:font-style-asian="italic" style:font-style-complex="italic"/>
</style:style>
<style:style style:name="Frame" style:family="graphic">
<style:graphic-properties text:anchor-type="paragraph" svg:x="0in" svg:y="0in" style:wrap="parallel" style:number-wrapped-paragraphs="no-limit" style:wrap-contour="false" style:vertical-pos="top" style:vertical-rel="paragraph-content" style:horizontal-pos="center" style:horizontal-rel="paragraph-content"/>
</style:style>
<style:style style:name="Graphics" style:family="graphic">
<style:graphic-properties text:anchor-type="paragraph" svg:x="0in" svg:y="0in" style:wrap="none" style:vertical-pos="top" style:vertical-rel="paragraph" style:horizontal-pos="center" style:horizontal-rel="paragraph"/>
</style:style>
<style:style style:name="OLE" style:family="graphic">
<style:graphic-properties text:anchor-type="paragraph" svg:x="0in" svg:y="0in" style:wrap="none" style:vertical-pos="top" style:vertical-rel="paragraph" style:horizontal-pos="center" style:horizontal-rel="paragraph"/>
</style:style>
<text:outline-style>
<text:outline-level-style text:level="1" style:num-suffix="  " style:num-format="1"/>
<text:outline-level-style text:level="2" style:num-suffix="  " style:num-format="1" text:display-levels="2"/>
<text:outline-level-style text:level="3" style:num-suffix="  " style:num-format="1" text:display-levels="3"/>
<text:outline-level-style text:level="4" style:num-suffix="  " style:num-format="1" text:display-levels="4"/>
<text:outline-level-style text:level="5" style:num-suffix="  " style:num-format="1" text:display-levels="5"/>
<text:outline-level-style text:level="6" style:num-suffix="  " style:num-format="1" text:display-levels="5"/>
<text:outline-level-style text:level="7" style:num-suffix="  " style:num-format="1" text:display-levels="5"/>
<text:outline-level-style text:level="8" style:num-suffix="  " style:num-format="1" text:display-levels="5"/>
<text:outline-level-style text:level="9" style:num-suffix="  " style:num-format="1" text:display-levels="5"/>
<text:outline-level-style text:level="10" style:num-suffix="  " style:num-format="1" text:display-levels="5"/>
</text:outline-style>
<text:list-style style:name="Numbering_20_1" style:display-name="Numbering 1">
<text:list-level-style-number text:level="1" style:num-suffix="." style:num-format="1"/>
<text:list-level-style-number text:level="2" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="0.1972in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="3" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="0.3937in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="4" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="0.5909in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="5" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="0.7874in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="6" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="0.9846in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="7" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="8" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="1.3783in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="9" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="1.5752in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="10" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="1.772in"/>
</text:list-level-style-number>
</text:list-style>
<text:list-style style:name="Numbering_20_2" style:display-name="Numbering 2">
<text:list-level-style-number text:level="1" text:style-name="Numbering_20_Symbols" style:num-format="1">
<style:list-level-properties text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="2" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="0.1965in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="3" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="3">
<style:list-level-properties text:space-before="0.3929in" text:min-label-width="0.3937in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="4" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="4">
<style:list-level-properties text:space-before="0.7866in" text:min-label-width="0.4925in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="5" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="5">
<style:list-level-properties text:space-before="1.2791in" text:min-label-width="0.5902in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="6" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="6">
<style:list-level-properties text:space-before="1.8693in" text:min-label-width="0.7091in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="7" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="7">
<style:list-level-properties text:space-before="2.5783in" text:min-label-width="0.9055in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="8" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="8">
<style:list-level-properties text:space-before="3.4839in" text:min-label-width="1.0236in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="9" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="9">
<style:list-level-properties text:space-before="4.5075in" text:min-label-width="1.1028in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="10" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="10">
<style:list-level-properties text:space-before="5.6102in" text:min-label-width="1.2209in"/>
</text:list-level-style-number>
</text:list-style>
<text:list-style style:name="Numbering_20_3" style:display-name="Numbering 3">
<text:list-level-style-number text:level="1" text:style-name="Numbering_20_Symbols" style:num-format="1">
<style:list-level-properties text:min-label-width="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="2" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="1.1815in" text:min-label-width="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="3" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="3">
<style:list-level-properties text:space-before="2.3626in" text:min-label-width="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="4" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="4">
<style:list-level-properties text:space-before="3.5441in" text:min-label-width="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="5" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="5">
<style:list-level-properties text:space-before="4.7252in" text:min-label-width="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="6" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="6">
<style:list-level-properties text:space-before="5.9063in" text:min-label-width="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="7" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="7">
<style:list-level-properties text:space-before="7.0878in" text:min-label-width="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="8" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="8">
<style:list-level-properties text:space-before="8.2689in" text:min-label-width="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="9" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="9">
<style:list-level-properties text:space-before="9.45in" text:min-label-width="1.1811in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="10" text:style-name="Numbering_20_Symbols" style:num-format="1" text:start-value="10">
<style:list-level-properties text:space-before="10.6315in" text:min-label-width="1.1811in"/>
</text:list-level-style-number>
</text:list-style>
<text:list-style style:name="Numbering_20_4" style:display-name="Numbering 4">
<text:list-level-style-number text:level="1" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I">
<style:list-level-properties text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="2" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I" text:start-value="2">
<style:list-level-properties text:space-before="0.1972in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="3" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I" text:start-value="3">
<style:list-level-properties text:space-before="0.3937in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="4" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I" text:start-value="4">
<style:list-level-properties text:space-before="0.5909in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="5" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I" text:start-value="5">
<style:list-level-properties text:space-before="0.7874in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="6" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I" text:start-value="6">
<style:list-level-properties text:space-before="0.9846in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="7" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I" text:start-value="7">
<style:list-level-properties text:space-before="1.1815in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="8" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I" text:start-value="8">
<style:list-level-properties text:space-before="1.3787in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="9" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I" text:start-value="9">
<style:list-level-properties text:space-before="1.5752in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="10" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="I" text:start-value="10">
<style:list-level-properties text:space-before="1.7724in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
</text:list-style>
<text:list-style style:name="Numbering_20_5" style:display-name="Numbering 5">
<text:list-level-style-number text:level="1" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:min-label-width="0.1575in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="2" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1" text:start-value="2" text:display-levels="2">
<style:list-level-properties text:space-before="0.1772in" text:min-label-width="0.2563in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="3" text:style-name="Numbering_20_Symbols" style:num-suffix=")" style:num-format="a" text:start-value="3">
<style:list-level-properties text:space-before="0.4331in" text:min-label-width="0.1772in"/>
</text:list-level-style-number>
<text:list-level-style-bullet text:level="4" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="0.6319in" text:min-label-width="0.1555in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="5" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="0.7874in" text:min-label-width="0.1555in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="6" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="0.9429in" text:min-label-width="0.1555in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="7" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="1.0988in" text:min-label-width="0.1555in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="8" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="1.2543in" text:min-label-width="0.1555in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="9" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="1.4098in" text:min-label-width="0.1555in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="10" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="1.5654in" text:min-label-width="0.1555in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
</text:list-style>
<text:list-style style:name="List_20_1" style:display-name="List 1">
<text:list-level-style-bullet text:level="1" text:style-name="Bullet_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:min-label-width="0.1575in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="2" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="0.1579in" text:min-label-width="0.1575in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="3" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="0.3146in" text:min-label-width="0.1575in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="4" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="0.4724in" text:min-label-width="0.1575in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="5" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="0.6299in" text:min-label-width="0.1575in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="6" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="0.7878in" text:min-label-width="0.1575in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="7" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="0.9445in" text:min-label-width="0.1575in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="8" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="1.1024in" text:min-label-width="0.1575in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="9" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="1.2598in" text:min-label-width="0.1575in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="10" text:style-name="Numbering_20_Symbols" text:bullet-char="•">
<style:list-level-properties text:space-before="1.4177in" text:min-label-width="0.1575in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
</text:list-style>
<text:list-style style:name="Bulleted_20_List" style:display-name="Bulleted List">
<text:list-level-style-bullet text:level="1" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="0.25in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="2" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="0.5in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="3" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="0.75in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="4" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="1in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="5" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="1.25in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="6" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="1.5in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="7" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="1.75in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="8" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="2in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="9" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="2.25in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="10" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="2.5in" text:min-label-width="0.1in"/>
<style:text-properties fo:font-family="StarSymbol" style:font-charset="x-symbol"/>
</text:list-level-style-bullet>
</text:list-style>
<text:list-style style:name="Numbered_20_List" style:display-name="Numbered List">
<text:list-level-style-number text:level="1" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="0.25in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="2" style:num-suffix="." style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="0.5in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="3" style:num-suffix="." style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="0.75in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="4" style:num-suffix="." style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="1in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="5" style:num-suffix="." style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="1.25in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="6" style:num-suffix="." style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="1.5in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="7" style:num-suffix="." style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="1.75in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="8" style:num-suffix="." style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="2in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="9" style:num-suffix="." style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="2.25in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="10" style:num-suffix="." style:num-format="1" text:start-value="2">
<style:list-level-properties text:space-before="2.5in" text:min-label-width="0.25in"/>
</text:list-level-style-number>
</text:list-style>
<text:notes-configuration text:note-class="footnote" text:citation-style-name="Footnote_20_Symbol" text:citation-body-style-name="Footnote_20_anchor" style:num-format="1" text:start-value="0" text:footnotes-position="page" text:start-numbering-at="document"/>
<text:notes-configuration text:note-class="endnote" style:num-format="i" text:start-value="0"/>
<text:linenumbering-configuration text:number-lines="false" text:offset="0.1965in" style:num-format="1" text:number-position="left" text:increment="5"/>
</office:styles>
<office:automatic-styles>
<style:style style:name="Table1" style:family="table">
<style:table-properties style:width="7.3229in" fo:margin-left="0in" fo:margin-right="-0.0042in" table:align="margins" style:may-break-between-rows="false"/>
</style:style>
<style:style style:name="Table1.A" style:family="table-column">
<style:table-column-properties style:column-width="3.3972in" style:rel-column-width="30402*"/>
</style:style>
<style:style style:name="Table1.B" style:family="table-column">
<style:table-column-properties style:column-width="3.9257in" style:rel-column-width="35133*"/>
</style:style>
<style:style style:name="Table1.A1" style:family="table-cell">
<style:table-cell-properties fo:padding="0.0382in" fo:border-left="0.0007in solid #000000" fo:border-right="none" fo:border-top="0.0007in solid #000000" fo:border-bottom="0.0007in solid #000000"/>
</style:style>
<style:style style:name="Table1.B1" style:family="table-cell">
<style:table-cell-properties fo:padding="0.0382in" fo:border="0.0007in solid #000000"/>
</style:style>
<style:style style:name="Table1.A2" style:family="table-cell">
<style:table-cell-properties style:vertical-align="middle" fo:padding="0.0382in" fo:border-left="0.0007in solid #000000" fo:border-right="none" fo:border-top="none" fo:border-bottom="0.0007in solid #000000"/>
</style:style>
<style:style style:name="Table1.B2" style:family="table-cell">
<style:table-cell-properties fo:padding="0.0382in" fo:border-left="0.0007in solid #000000" fo:border-right="0.0007in solid #000000" fo:border-top="none" fo:border-bottom="0.0007in solid #000000"/>
</style:style>
<style:style style:name="P1" style:family="paragraph" style:parent-style-name="Signature">
<style:paragraph-properties fo:text-align="center" style:justify-single-word="false"/>
</style:style>
<style:style style:name="P2" style:family="paragraph" style:parent-style-name="Contents_20_1">
<style:paragraph-properties>
<style:tab-stops/>
</style:paragraph-properties>
</style:style>
<style:style style:name="P3" style:family="paragraph" style:parent-style-name="Contents_20_2">
<style:paragraph-properties>
<style:tab-stops/>
</style:paragraph-properties>
</style:style>
<style:style style:name="P4" style:family="paragraph" style:parent-style-name="Contents_20_3">
<style:paragraph-properties>
<style:tab-stops/>
</style:paragraph-properties>
</style:style>
<style:style style:name="P5" style:family="paragraph" style:parent-style-name="Contents_20_4">
<style:paragraph-properties>
<style:tab-stops/>
</style:paragraph-properties>
</style:style>
<style:style style:name="P6" style:family="paragraph" style:parent-style-name="CodeExample">
<style:text-properties fo:font-weight="normal" style:font-weight-asian="normal" style:font-weight-complex="normal"/>
</style:style>
<style:style style:name="P7" style:family="paragraph" style:parent-style-name="CodeExample">
<style:text-properties fo:font-style="normal" fo:font-weight="normal" style:font-style-asian="normal" style:font-weight-asian="normal" style:font-style-complex="normal" style:font-weight-complex="normal"/>
</style:style>
<style:style style:name="P8" style:family="paragraph" style:parent-style-name="Text_20_body">
<style:text-properties fo:font-style="normal" fo:font-weight="normal" style:font-style-asian="normal" style:font-weight-asian="normal" style:font-style-complex="normal" style:font-weight-complex="normal"/>
</style:style>
<style:style style:name="P9" style:family="paragraph" style:parent-style-name="Title" style:master-page-name="HTML">
<style:paragraph-properties style:page-number="auto"/>
</style:style>
<style:style style:name="T1" style:family="text">
<style:text-properties fo:font-style="normal" style:font-style-asian="normal" style:font-style-complex="normal"/>
</style:style>
<style:style style:name="T2" style:family="text">
<style:text-properties fo:font-style="normal" fo:font-weight="bold" style:font-style-asian="normal" style:font-weight-asian="bold" style:font-style-complex="normal" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="T3" style:family="text">
<style:text-properties fo:font-style="normal" fo:font-weight="normal" style:font-style-asian="normal" style:font-weight-asian="normal" style:font-style-complex="normal" style:font-weight-complex="normal"/>
</style:style>
<style:style style:name="T4" style:family="text">
<style:text-properties fo:font-style="italic"/>
</style:style>
<style:style style:name="T5" style:family="text">
<style:text-properties fo:font-style="italic" style:font-style-asian="italic" style:font-style-complex="italic"/>
</style:style>
<style:style style:name="T6" style:family="text">
<style:text-properties fo:font-style="italic" fo:font-weight="bold" style:font-style-asian="italic" style:font-weight-asian="bold" style:font-style-complex="italic" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="T7" style:family="text">
<style:text-properties fo:font-style="italic" fo:font-weight="normal" style:font-style-asian="italic" style:font-weight-asian="normal" style:font-style-complex="italic" style:font-weight-complex="normal"/>
</style:style>
<style:style style:name="T8" style:family="text">
<style:text-properties fo:font-weight="bold"/>
</style:style>
<style:style style:name="T9" style:family="text">
<style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="T10" style:family="text">
<style:text-properties fo:font-weight="normal" style:font-weight-asian="normal" style:font-weight-complex="normal"/>
</style:style>
<style:style style:name="T11" style:family="text">
<style:text-properties fo:font-size="10pt" fo:font-weight="bold" style:font-size-asian="10pt" style:font-weight-asian="bold" style:font-size-complex="10pt" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Sect1" style:family="section">
<style:section-properties fo:background-color="transparent" style:editable="false">
<style:columns fo:column-count="1" fo:column-gap="0in"/>
<style:background-image/>
</style:section-properties>
</style:style>
<style:style style:name="Sect2" style:family="section">
<style:section-properties style:editable="false">
<style:columns fo:column-count="1" fo:column-gap="0in"/>
</style:section-properties>
</style:style>
<style:page-layout style:name="pm1">
<style:page-layout-properties fo:page-width="8.5in" fo:page-height="11in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="1in" fo:margin-bottom="1in" fo:margin-left="1.25in" fo:margin-right="1.25in" style:writing-mode="lr-tb" style:footnote-max-height="0in">
<style:footnote-sep style:width="0.0071in" style:distance-before-sep="0.0398in" style:distance-after-sep="0.0398in" style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
</style:page-layout-properties>
<style:header-style/>
<style:footer-style/>
</style:page-layout>
<style:page-layout style:name="pm2">
<style:page-layout-properties fo:page-width="8.5in" fo:page-height="11in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="0.3937in" fo:margin-bottom="0.3937in" fo:margin-left="0.7874in" fo:margin-right="0.3937in" fo:background-color="transparent" style:writing-mode="lr-tb" style:footnote-max-height="0in">
<style:background-image/>
<style:footnote-sep style:width="0.0071in" style:distance-before-sep="0.0398in" style:distance-after-sep="0.0398in" style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
</style:page-layout-properties>
<style:header-style/>
<style:footer-style/>
</style:page-layout>
<style:page-layout style:name="pm3">
<style:page-layout-properties fo:page-width="8.5in" fo:page-height="11in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="1in" fo:margin-bottom="1in" fo:margin-left="1.25in" fo:margin-right="1.25in" style:writing-mode="lr-tb" style:footnote-max-height="0in">
<style:footnote-sep style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
</style:page-layout-properties>
<style:header-style/>
<style:footer-style/>
</style:page-layout>
<number:date-style style:name="N37" number:automatic-order="true">
<number:month number:style="long"/>
<number:text>/</number:text>
<number:day number:style="long"/>
<number:text>/</number:text>
<number:year/>
</number:date-style>
<number:time-style style:name="N116">
<number:hours number:style="long"/>
<number:text>:</number:text>
<number:minutes number:style="long"/>
<number:text>:</number:text>
<number:seconds number:style="long"/>
<number:am-pm/>
</number:time-style>
</office:automatic-styles>
<office:master-styles>
<style:master-page style:name="Standard" style:page-layout-name="pm1"/>
<style:master-page style:name="HTML" style:page-layout-name="pm2"/>
<style:master-page style:name="Endnote" style:page-layout-name="pm3"/>
</office:master-styles>
<office:body>
<office:text text:use-soft-page-breaks="true">
<office:forms form:automatic-focus="false" form:apply-design-mode="false"/>
<text:sequence-decls>
<text:sequence-decl text:display-outline-level="0" text:name="Illustration"/>
<text:sequence-decl text:display-outline-level="0" text:name="Table"/>
<text:sequence-decl text:display-outline-level="0" text:name="Text"/>
<text:sequence-decl text:display-outline-level="0" text:name="Drawing"/>
</text:sequence-decls>
<text:p text:style-name="P9">NeatHtml: Displaying Untrusted Content<text:line-break/>Securely, Efficiently, and Accessibly</text:p>
<text:p text:style-name="Subtitle">How To Fight Cross-Site Scripting (XSS), Cross-Site Request Forgery (CSRF), and Phishing <text:line-break/>with JavaScript Judo, Layout Lockdown, and a Table Trap</text:p>
<text:p text:style-name="P1">
<text:span text:style-name="Emphasis">
<text:span text:style-name="T1">by </text:span>
</text:span>
<text:a xlink:type="simple" xlink:href="http://www.brettle.com/">
<text:span text:style-name="Emphasis">
<text:span text:style-name="T1">Dean Brettle</text:span>
</text:span>
</text:a>
<text:a xlink:type="simple" xlink:href="http://www.brettle.com/"/>
<text:a xlink:type="simple" xlink:href="http://www.brettle.com/">
<text:span text:style-name="T1">
<text:line-break/>
</text:span>
</text:a>
<text:span text:style-name="Emphasis">
<text:span text:style-name="T1">Last updated </text:span>
</text:span>
<text:span text:style-name="Emphasis">
<text:span text:style-name="T1">
<text:date style:data-style-name="N37" text:date-value="2008-02-23T13:37:08">02/23/08</text:date>
</text:span>
</text:span>
<text:span text:style-name="Emphasis">
<text:span text:style-name="T1"/>
</text:span>
<text:span text:style-name="Emphasis">
<text:span text:style-name="T1">
<text:time style:data-style-name="N116" text:time-value="2008-02-23T13:37:08">01:37:08PM</text:time>
</text:span>
</text:span>
<text:span text:style-name="Emphasis">
<text:span text:style-name="T1"/>
</text:span>
</text:p>
<text:table-of-content text:style-name="Sect1" text:protected="true" text:name="Table of Contents1">
<text:table-of-content-source text:outline-level="10">
<text:index-title-template text:style-name="Contents_20_Heading">Table of Contents</text:index-title-template>
<text:table-of-content-entry-template text:outline-level="1" text:style-name="Contents_20_1">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
<text:table-of-content-entry-template text:outline-level="2" text:style-name="Contents_20_2">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
<text:table-of-content-entry-template text:outline-level="3" text:style-name="Contents_20_3">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
<text:table-of-content-entry-template text:outline-level="4" text:style-name="Contents_20_4">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
<text:table-of-content-entry-template text:outline-level="5" text:style-name="Contents_20_5">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
<text:table-of-content-entry-template text:outline-level="6" text:style-name="Contents_20_6">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
<text:table-of-content-entry-template text:outline-level="7" text:style-name="Contents_20_7">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
<text:table-of-content-entry-template text:outline-level="8" text:style-name="Contents_20_8">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
<text:table-of-content-entry-template text:outline-level="9" text:style-name="Contents_20_9">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
<text:table-of-content-entry-template text:outline-level="10" text:style-name="Contents_20_10">
<text:index-entry-chapter/>
<text:index-entry-link-start text:style-name="Internet_20_link"/>
<text:index-entry-text/>
<text:index-entry-link-end/>
</text:table-of-content-entry-template>
</text:table-of-content-source>
<text:index-body>
<text:index-title text:style-name="Sect2" text:name="Table of Contents1_Head">
<text:p text:style-name="Contents_20_Heading">Table of Contents</text:p>
</text:index-title>
<text:p text:style-name="P2">1 <text:s/>
<text:a xlink:type="simple" xlink:href="#1.Overview|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Overview</text:a>
</text:p>
<text:p text:style-name="P2">2 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.Technical Details|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Technical Details</text:a>
</text:p>
<text:p text:style-name="P3">2.1 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.1.Defending Most Users with JavaScript Judo and Layout Lockdown|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Defending Most Users with JavaScript Judo and Layout Lockdown</text:a>
</text:p>
<text:p text:style-name="P4">2.1.1 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.1.1.Preventing XSS and Removing Automated CSRF Attacks with JavaScript Judo|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Preventing XSS and Removing Automated CSRF Attacks with JavaScript Judo</text:a>
</text:p>
<text:p text:style-name="P5">2.1.1.1 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.1.1.1.Playing Hide and Seek with Untrusted Content|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Playing Hide and Seek with Untrusted Content</text:a>
</text:p>
<text:p text:style-name="P5">2.1.1.2 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.1.1.2.Filtering Untrusted Content with JavaScript|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Filtering Untrusted Content with JavaScript</text:a>
</text:p>
<text:p text:style-name="P5">2.1.1.3 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.1.1.3.Displaying the Filtered Content|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Displaying the Filtered Content</text:a>
</text:p>
<text:p text:style-name="P4">2.1.2 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.1.2.Preventing Phishing and Containing Vandalism with Layout Lockdown|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Preventing Phishing and Containing Vandalism with Layout Lockdown</text:a>
</text:p>
<text:p text:style-name="P3">2.2 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.2.Defending No-Script Users with Regex Replacements, Layout Lockdown, and a Table Trap|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Defending No-Script Users with Regex Replacements, Layout Lockdown, and a Table Trap</text:a>
</text:p>
<text:p text:style-name="P4">2.2.1 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.2.1.Sacrificing Well-Formedness|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Sacrificing Well-Formedness</text:a>
</text:p>
<text:p text:style-name="P4">2.2.2 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.2.2.Preventing Phishing and Containing Vandalism with Layout Lockdown and a Table Trap|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Preventing Phishing and Containing Vandalism with Layout Lockdown and a Table Trap</text:a>
</text:p>
<text:p text:style-name="P5">2.2.2.1 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.2.2.1.Handling HTML Comments and CDATA Sections in Untrusted Content|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Handling HTML Comments and CDATA Sections in Untrusted Content</text:a>
</text:p>
<text:p text:style-name="P5">2.2.2.2 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.2.2.2.Allowing Tables in Untrusted Content|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Allowing Tables in Untrusted Content</text:a>
</text:p>
<text:p text:style-name="P4">2.2.3 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.2.3.Removing Automated CSRF Attacks by Disabling Suspicious Tags and Attributes|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Removing Automated CSRF Attacks by Disabling Suspicious Tags and Attributes</text:a>
</text:p>
<text:p text:style-name="P4">2.2.4 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.2.4.Preventing CSS Counter Manipulation|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Preventing CSS Counter Manipulation</text:a>
</text:p>
<text:p text:style-name="P3">2.3 <text:s/>
<text:a xlink:type="simple" xlink:href="#2.3.Preventing NeatHtml from Being Used for Denial of Service Attacks|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Preventing NeatHtml from Being Used for Denial of Service Attacks</text:a>
</text:p>
<text:p text:style-name="P2">3 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.Future Work|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Future Work</text:a>
</text:p>
<text:p text:style-name="P3">3.1 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.1.Improving Server-Side Performance|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Improving Server-Side Performance</text:a>
</text:p>
<text:p text:style-name="P4">3.1.1 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.1.1.Making Style Checking Optional|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Making Style Checking Optional</text:a>
</text:p>
<text:p text:style-name="P4">3.1.2 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.1.2.Avoiding No-Script Processing When JavaScript Is Enabled|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Avoiding No-Script Processing When JavaScript Is Enabled</text:a>
</text:p>
<text:p text:style-name="P3">3.2 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.2.Adding New Features and Ports|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Adding New Features and Ports</text:a>
</text:p>
<text:p text:style-name="P4">3.2.1 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.2.1.Discouraging Link Spam|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Discouraging Link Spam</text:a>
</text:p>
<text:p text:style-name="P4">3.2.2 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.2.2.Improving CSRF Removal|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Improving CSRF Removal</text:a>
</text:p>
<text:p text:style-name="P4">3.2.3 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.2.3.Supporting Inline Untrusted Content|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Supporting Inline Untrusted Content</text:a>
</text:p>
<text:p text:style-name="P4">3.2.4 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.2.4.Running Untrusted Scripts in a Restricted Environment|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Running Untrusted Scripts in a Restricted Environment</text:a>
</text:p>
<text:p text:style-name="P4">3.2.5 <text:s/>
<text:a xlink:type="simple" xlink:href="#3.2.5.Porting the Server-Side Code to Other Environments|outline" text:style-name="Internet_20_link" text:visited-style-name="Internet_20_link">Porting the Server-Side Code to Other Environments</text:a>
</text:p>
</text:index-body>
</text:table-of-content>
<text:h text:style-name="Heading_20_1" text:outline-level="1">Overview</text:h>
<text:p text:style-name="Text_20_body">
<text:a xlink:type="simple" xlink:href="http://www.brettle.com/neathtml">NeatHtml™</text:a> is a highly-portable <text:a xlink:type="simple" xlink:href="http://www.opensource.org/">open source</text:a> website component that displays untrusted content securely, efficiently, and accessibly. <text:s/>Untrusted content is any content that is not trusted by the website owner. <text:s/>Typical examples include blog comments, forum posts, or user pages on <text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Social_networking">social networking</text:a> sites. <text:s/>NeatHtml uses an “accept only known good” (whitelist) approach to security to help prevent attacks which are not yet known. <text:s text:c="2"/>It focuses on preventing <text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Xss">Cross-Site Scripting</text:a> (XSS) attacks but can also prevent <text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Phishing">phishing</text:a> attacks and remove automated <text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Cross_site_request_forgery">Cross-Site Request Forgery</text:a> (CSRF) attacks. <text:s/>In this context, phishing attacks are attacks which try <text:soft-page-break/>to display untrusted content where the user would trust it, and automated CSRF attacks are CSRF attacks that do not require any user action beyond viewing the untrusted content.</text:p>
<text:p text:style-name="Text_20_body">NeatHtml primarily uses three simple but effective techniques. <text:s/>The first technique uses JavaScript's document.writeln() to inject markup (e.g. “&lt;!--”) that will hide the untrusted content from the browser's HTML parser until the untrusted content has been filtered. <text:s/>This "JavaScript Judo" technique uses the source of an attacker's power (i.e. JavaScript) against him. <text:s/>Using JavaScript to filter the untrusted content also minimizes server load. <text:s/>The technique was inspired by <text:a xlink:type="simple" xlink:href="http://www.mindedsecurity.com/">Stefano Di Paola's</text:a> work on <text:a xlink:type="simple" xlink:href="http://www.wisec.it/sectou.php?id=46c5843ea4900">Preventing XSS with Data Binding</text:a>. <text:s/>The primary disadvantage to the data binding approach is that the untrusted content is not in the normal document flow. <text:s/>This causes accessibility problems for users who disable script and for search engine spiders. <text:s/>NeatHtml avoids this problem by leaving the untrusted content in the document flow but using JavaScript-injected markup to hide it from the browser until it has been filtered. <text:s/>As a result, search engine spiders and users who disable script see untrusted content normally.</text:p>
<text:p text:style-name="Text_20_body">NeatHtml's two other techniques restrict where the untrusted content will be displayed. <text:s/>The “Layout Lockdown” technique is merely a DIV element styled with “<text:a xlink:type="simple" xlink:href="http://www.w3.org/TR/REC-CSS2/visufx.html#overflow">overflow</text:a>: hidden” combined with workarounds for Internet Explorer 6. <text:s/>The “Table Trap” technique protects no-script users from untrusted content which tries to close a containing trusted element like the Layout Lockdown DIV element. <text:s/>A Table Trap prevents this by enclosing the untrusted content in a TABLE element and prohibiting the untrusted content from closing the TABLE. <text:s/>All three techniques are discussed in more detail in <text:a xlink:type="simple" xlink:href="#2.Technical Details|outline">Section 2</text:a>.</text:p>
<text:p text:style-name="Text_20_body">NeatHtml should work with any browser that supports both JavaScript 1.3 and a few DOM APIs. It does <text:span text:style-name="T4">not</text:span> use the browser's internal XML/HTML parser to parse the untrusted content, thereby eliminating many browser compatibility issues. It has been tested against:</text:p>
<text:list text:style-name="Bulleted_20_List">
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Microsoft Internet Explorer (IE) version 7.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Microsoft Internet Explorer (IE) version 6.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Mozilla Firefox (FF) versions 1.5 and 2.0.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Opera 9.21.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Netscape 7.2.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Mac Safari versions 1.2, 1.3, and 2.0.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Konqueror 3.4.0-5 and 3.5.7.</text:p>
</text:list-item>
</text:list>
<text:p text:style-name="Text_20_body">NeatHtml consists of the NeatHtml.js JavaScript library and a small server-side component for ASP.NET. <text:s/>The server-side component is approximately 400 lines of code and should be easy to port to other web development platforms. <text:s/>To facilitate porting and testing, NeatHtml includes a JavaScript test framework and a <text:a xlink:type="simple" xlink:href="http://www.brettle.com/NeatHtml/dotnet/Demo.aspx">demo page</text:a> which uses the test framework and demonstrates the capabilities of NeatHtml. <text:s/>NeatHtml is licensed under the <text:a xlink:type="simple" xlink:href="http://www.gnu.org/copyleft/lesser.html#TOC1">
<text:span text:style-name="T8">Lesser</text:span>
</text:a>
<text:a xlink:type="simple" xlink:href="http://www.gnu.org/copyleft/lesser.html#TOC1"/>
<text:a xlink:type="simple" xlink:href="http://www.gnu.org/copyleft/lesser.html#TOC1">General Public License (LGPL)</text:a>, a business-friendly <text:a xlink:type="simple" xlink:href="http://opensource.org/docs/definition.php">open source</text:a> license.</text:p>
<text:p text:style-name="Text_20_body">NeatHtml is currently available for <text:a xlink:type="simple" xlink:href="http://www.brettle.com/neathtml#Download">download</text:a> as a mature development snapshot. <text:s/>It primarily needs independent testing before an official release. <text:s/>
<text:a xlink:type="simple" xlink:href="http://www.brettle.com/ForumView.aspx?ItemID=11&amp;mid=57&amp;pageindex=9&amp;pageid=39">Bug reports</text:a>, <text:a xlink:type="simple" xlink:href="http://www.brettle.com/ForumView.aspx?ItemID=12&amp;mid=57&amp;pageindex=9&amp;pageid=39">feature requests</text:a>, <text:a xlink:type="simple" xlink:href="http://www.brettle.com/ForumView.aspx?ItemID=10&amp;mid=57&amp;pageindex=9&amp;pageid=39">questions</text:a>, <text:a xlink:type="simple" xlink:href="http://www.brettle.com/ForumView.aspx?ItemID=13&amp;mid=57&amp;pageindex=9&amp;pageid=39">comments</text:a>, and other contributions are welcome.</text:p>
<text:h text:style-name="Heading_20_1" text:outline-level="1">Technical Details</text:h>
<text:p text:style-name="Text_20_body">This section describes the various techniques that NeatHtml uses. <text:s/>To simplify the presentation, the problem is broken into smaller subproblems and the techniques used to address each of the subproblems is described. <text:s/>
<text:soft-page-break/>NeatHtml uses all of the techniques in combination; other solutions could use a subset of the techniques to address a subset of the problems. <text:s/>For example, if the untrusted content is an entire user page on a social networking site, preventing phishing and vandalism might not be a concern and the associated techniques would not need to be applied.</text:p>
<text:h text:style-name="Heading_20_2" text:outline-level="2">Defending Most Users with JavaScript Judo and Layout Lockdown</text:h>
<text:p text:style-name="Text_20_body">As of January 2007, approximately <text:a xlink:type="simple" xlink:href="http://www.w3schools.com/browsers/browsers_stats.asp">94% of users have JavaScript enabled</text:a>. <text:s/>Defenses which rely on JavaScript obviously directly protect users that have JavaScript enabled. <text:s/>Such defenses <text:span text:style-name="T5">also</text:span> indirectly protect no-script users by reducing the expected value of a non-targeted attack by a factor of almost 20. <text:s/>NeatHtml uses the techniques described in this section to achieve these benefits. <text:s/>It also uses other techniques, described later, to directly protect non-script users.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Preventing XSS and Removing Automated CSRF Attacks with JavaScript Judo</text:h>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Playing Hide and Seek with Untrusted Content</text:h>
<text:p text:style-name="Text_20_body">To prevent XSS and remove automated CSRF attacks, the untrusted content must be filtered before the browser interprets it as HTML. <text:s/>To prevent XSS, the filter must at least address SCRIPT elements, on<text:span text:style-name="Variable">Event</text:span> attributes, and expression() calls in inline styles. <text:s/>To remove automated CSRF attacks, the filter must at least address IMG, IFRAME, and OBJECT elements, and url() calls in inline styles. <text:s/>This filtering is normally performed on the server, using either a blacklist or a whitelist approach. <text:s/>The blacklist approach typically produces less load on the server but is less secure than a whitelist approach. <text:s/>A whitelist approach requires parsing the untrusted content (both the HTML and its inline styles) before passing it to the browser. <text:s/>Such parsing produces enough load on the server that it may not be practical to do the parsing each time the untrusted content is sent to the browser. <text:s/>Filtering the untrusted content when it is created would solve the load problem, but has its own disadvantages. <text:s/>It is generally more complicated to implement because the type of filtering required can vary over time and across users. <text:s/>For example, it might be desirable to let the content's author (or an administrator) see their unfiltered content for editing (or auditing) purposes. <text:s/>Filtering the content at creation time, also means that if a bug is fixed in the filter, all previously filtered content needs to be refiltered. <text:s/>Keeping track of which content has been filtered with which filter can add significant complexity to an application. <text:s/>That complexity can be especially onerous when trying to secure existing applications.</text:p>
<text:p text:style-name="Text_20_body">To avoid the above issues, NeatHtml does most of its filtering using JavaScript in the browser. <text:s/>This means that the untrusted content must be hidden from the browser's HTML parser until it has been filtered. <text:s/>One way to achieve this is to enclose the untrusted content in an HTML comment and then use JavaScript to extract it, filter it, and replace the comment with the result. <text:s/>Before doing this, the server must replace all “--” with “&amp;#34;&amp;#34;” in the untrusted content. <text:s/>That preprocessing ensures that the comment is not ended prematurely. <text:s/>The preprocessing is undone by the JavaScript code before the untrusted content is filtered. <text:s/>The result is below. <text:s/>The ProcessUntrusted() method is responsible for extracting the preprocessed untrusted content, undoing the preprocessing, filtering the untrusted content, and replacing the comment with the filtered result.</text:p>
<text:p text:style-name="CodeExample">
<text:soft-page-break/>
<text:span text:style-name="T9">&lt;!-- </text:span>
<text:span text:style-name="Variable">preprocessed untrusted content </text:span>
<text:span text:style-name="T9">--&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T9">&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/>&lt;/script&gt;</text:span>
</text:p>
<text:p text:style-name="Text_20_body">This works well in most browsers, but fails in Safari and Konqueror because those browsers don't provide access to comments from JavaScript. <text:s/>An alternative is to enclose the untrusted content in an XMP element (after removing or replacing “&lt;/xmp&gt;”), like this:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T9">&lt;xmp&gt;</text:span>
<text:span text:style-name="Variable">preprocessed untrusted content</text:span>
<text:span text:style-name="T9">&lt;/xmp&gt;</text:span>
<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/>&lt;/script&gt;</text:p>
<text:p text:style-name="Text_20_body">This appears to work in most browsers, including Safari and Konqueror. <text:s/>However, the XMP element is not part of the HTML4 standard, so future browsers might not support it and might even ignore the XMP tags and parse the untrusted content as HTML. <text:s/>Also, strictly speaking, even earlier versions of HTML specified that the string “&lt;/” was not allowed inside the XMP element. <text:s/>Luckily most browsers seem to ignore that part of the specification and treat everything until the “&lt;/xmp&gt;” as plain text.</text:p>
<text:p text:style-name="Text_20_body">NeatHtml dynamically chooses which of the above techniques to use. <text:s/>The server prepends a test comment followed by script which calls NeatHtml's BeginUntrusted() method. <text:s/>That method checks whether the comment is accessible. <text:s/>If it is, the script injects “&lt;!--” using document.writeln(). <text:s/>If comments are not accessible, the script injects “&lt;xmp&gt;”. <text:s/>The server replaces both “--” and “&lt;/xmp&gt;” in the untrusted content and follows the content with the string “&lt;!‑‑ &gt; ‑‑&gt;&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;”, like this:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T9">&lt;!-- test comment --&gt;<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.BeginUntrusted();<text:line-break/>&lt;/script&gt;</text:span>
<text:line-break/>
<text:span text:style-name="Variable">preprocessed untrusted content</text:span>
<text:line-break/>
<text:span text:style-name="T9">&lt;!-- &gt; --&gt;&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;</text:span>
<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/>&lt;/script&gt;</text:p>
<text:p text:style-name="Text_20_body">The string “&lt;!‑‑ &gt; ‑‑&gt;&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;” is designed to close either an open comment or an open XMP element. <text:s/>The “&gt;” in the first comment is needed because many browsers interpret “--” as ending a comment but allow a new comment to be started if another “--” occurs before the tag is closed with an “&gt;”. <text:s/>The comment enclosing the “&lt;xmp&gt;&lt;/xmp&gt;” hides those tags from browsers where the XMP element is not used and ensures that they don't cause validation errors. <text:s/>The last “&lt;!” hides the ending “--&gt;” from browsers where the XMP element is used.</text:p>
<text:p text:style-name="Text_20_body">Hiding the untrusted content using HTML injected by JavaScript has another major advantage – the untrusted content is <text:span text:style-name="T5">not</text:span> hidden from no-script users. <text:s/>They will see the untrusted content in the normal document flow. <text:s/>Of course this means that it is important to do additional server-side preprocessing to prevent attacks on no-script users. <text:s/>That is described in <text:a xlink:type="simple" xlink:href="#2.2.Defending No-Script Users with Regex Replacements, a Table Trap, and Layout Lockdown|outline">section 2.2</text:a>.</text:p>
<text:p text:style-name="Text_20_body">On a related note, the untrusted content will not be hidden if the call to NeatHtml.DefaultFilter.BeginUntrusted() fails for any reason. <text:s/>The most common reason would be forgetting to include NeatHtml.js on the page. <text:s/>To ensure that such a mistake does not result in untrusted content being displayed to script users, the server adds a fail-safe:</text:p>
<text:p text:style-name="CodeExample">
<text:soft-page-break/>
<text:span text:style-name="T10">&lt;!-- test comment --&gt;</text:span>
<text:span text:style-name="T9">
<text:line-break/>
</text:span>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T9">try { </text:span>
<text:span text:style-name="T10">NeatHtml.DefaultFilter.BeginUntrusted();</text:span>
<text:span text:style-name="T9">} <text:line-break/> catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }<text:line-break/>
</text:span>
<text:span text:style-name="T10">&lt;/script&gt; </text:span>
<text:line-break/>
<text:span text:style-name="Variable">preprocessed untrusted content</text:span>
<text:line-break/>
<text:span text:style-name="T10">&lt;!-- &gt; --&gt;&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt; </text:span>
<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/>&lt;/script&gt;</text:p>
<text:p text:style-name="Text_20_body">That will cause the untrusted content to be hidden in a comment if something goes wrong. <text:s/>Using '...\074-' + '-' instead of <text:s/>'&lt;!--' simply ensures that the script source code doesn't open any tags (\074 is the octal escape for '&lt;') or end any comments.</text:p>
<text:p text:style-name="Text_20_body">Dynamically choosing which way to hide the untrusted content makes it a little harder for ProcessUntrusted() to find it. <text:s/>To assist with this, BeginUntrusted() notes the script element that called it so that ProcessUntrusted() can extract the untrusted content from the following node (i.e. the comment or XMP element). <text:s/>Also, the server adds a sentinel string after the untrusted content so that ProcessUntrusted() can determine where the untrusted content ends and doesn't have to worry about the portion of “&lt;!‑‑ &gt; ‑‑&gt;&lt;xmp&gt;&lt;/xmp&gt;” which is not applicable for the hiding method being used. <text:s/>Any string which would not generally occur in benign content will work as a sentinel string. <text:s/>The sentinel string that NeatHtml uses is in bold below:</text:p>
<text:p text:style-name="CodeExample">&lt;!-- test comment --&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
</text:p>
<text:p text:style-name="P6">
<text:s/>try { NeatHtml.DefaultFilter.BeginUntrusted(); } <text:line-break/> catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T10">&lt;/script&gt; </text:span>
<text:line-break/>
<text:span text:style-name="Variable">preprocessed untrusted content<text:line-break/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T2">&lt;NeatHtmlEndUntrusted</text:span>
</text:span> xmlns='http://www.brettle.com/neathtml/2008'<text:span text:style-name="Variable">
<text:span text:style-name="T3">/&gt;</text:span>
</text:span>
<text:line-break/>&lt;!-- &gt; --&gt;<text:span text:style-name="T10">&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;</text:span>
<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/>&lt;/script&gt;</text:p>
<text:p text:style-name="Text_20_body">The xmlns attribute is only used because NeatHtmlEndUntrusted is not a valid HTML element.</text:p>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Filtering Untrusted Content with JavaScript</text:h>
<text:p text:style-name="Text_20_body">Once ProcessUntrusted() has obtained the preprocessed untrusted content and undone the server's preprocessing, it needs to filter the original untrusted content. <text:s/>To maximize security and provide the best user experience, ProcessUntrusted() actually parses the untrusted content and converts it to secure, well-formed XHTML that all browsers should parse consistently. <text:s/>The parser can handle poorly formed “tag soup” HTML. <text:s/>Specifically, the filter:</text:p>
<text:list text:style-name="Bulleted_20_List">
<text:list-item text:start-value="1">
<text:p text:style-name="Bulleted_20_List">removes tags which are not on a whitelist (e.g. “&lt;foo&gt;some &lt;b&gt;content&lt;/b&gt;&lt;/foo&gt;” becomes “some &lt;b&gt;content&lt;/b&gt;”). <text:s/>The whitelist does not contain tags which could be used for XSS attacks (e.g. SCRIPT) or automated CSRF attacks (e.g. IMG).</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">removes content from SCRIPT elements so that it isn't displayed after removing the tag (e.g. “&lt;script&gt;a=b&lt;/script&gt;” is removed entirely)</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">removes attributes with names that aren't on a whitelist. <text:s/>The whitelist does not contain attributes which could be used for XSS attacks (e.g. ONCLICK) or automated CSRF attacks (e.g. SRC).</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">parses STYLE attributes and removes properties with names that aren't on a whitelist or values that don't match a whitelist regular expression. <text:s/>The property name whitelist does not contain properties <text:soft-page-break/>which could be used for automated CSRF attacks (e.g. BACKGROUND-IMAGE), and the property value whitelist regular expression will not match values that could be used for XSS attacks (e.g. “expression()”) or automated CSRF attacks (e.g. “url()”). <text:s/>
</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">removes HREF attributes with URLs that don't match the regular expression “^(http:|https:|ftp:|mailto:|[#./])”</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">adds a prefix to the value of ID attributes to prevent “ID spoofing” where a malicious element uses the ID of an element in trusted content in hopes that trusted script will attach an event handler to it instead of to the trusted element</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">removes HTML comments</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">extracts the contents of CDATA sections and replaces the section with the HTML-encoded content (e.g. “&lt;![CDATA[a&lt;b]]&gt;” becomes “a&amp;lt;b”)</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">HTML-encodes XML processing instructions (e.g. “&lt;?do something ?&gt;” becomes “&amp;lt;?do something ?&amp;gt;”)</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">adds optional end tags (e.g. “&lt;p&gt;foo&lt;p&gt;bar” becomes “&lt;p&gt;foo&lt;/p&gt;&lt;p&gt;bar&lt;/p&gt;”)</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">correctly closes elements which must be empty (e.g. “&lt;br&gt;” becomes “&lt;br /&gt;”)</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">quotes unquoted attributes</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">adds implicit attribute values (e.g. “&lt;ul compact&gt;” becomes “&lt;ul compact='compact'&gt;”)</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">encodes non-printable and non-ASCII characters in attribute values</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">encodes “&lt;” and “&amp;” characters in content when they are not the start of a tag or HTML entity</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">converts named character entities that are not part of the XHTML standard to numeric character entities (e.g. “&amp;nbsp;” becomes “&amp;#160;”)</text:p>
</text:list-item>
</text:list>
<text:p text:style-name="Text_20_body">Applications can configure the parser to call arbitrary functions for particular element or attribute names. <text:s/>The functions used to provide the whitelisting functionality described above are part of NeatHtml's JavaScript API, so that it is simple to add elements and attributes to the whitelists. <text:s/>The whitelists used by default can be found in <text:a xlink:type="simple" xlink:href="https://forgesvn1.novell.com/viewsvn/neathtml/trunk/js/NeatHtml.js?view=markup">NeatHtml.js</text:a> by searching for “allowedTags”, “prohibitedTags” (i.e. tags whose content is removed), “allowedAttrs”, and “allowedProps”. <text:s/>The whitelist regular expression used for style property values is part of the “StyleDeclRe” used to find style property declaration within the style attribute.</text:p>
<text:p text:style-name="Text_20_body">To make the filter's job slightly easier, it ignores everything after the first top-level element. <text:s/>To accommodate this, the server encloses the preprocessed untrusted content in a DIV element, like this:</text:p>
<text:p text:style-name="CodeExample">&lt;!-- test comment --&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
</text:p>
<text:p text:style-name="P6">
<text:s/>try { NeatHtml.DefaultFilter.BeginUntrusted(); }<text:line-break/> catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T10">&lt;/script&gt; </text:span>
<text:line-break/>
<text:span text:style-name="T9">&lt;div&gt;</text:span>
<text:line-break/>
<text:span text:style-name="Variable">preprocessed untrusted content<text:line-break/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T2">&lt;/div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:line-break/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;NeatHtmlEndUntrusted xmlns='http://www.brettle.com/neathtml/2008'/&gt;</text:span>
</text:span>
<text:line-break/>&lt;!-- &gt; --&gt;<text:span text:style-name="T10">&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;</text:span>
<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/>&lt;/script&gt;</text:p>
<text:p text:style-name="Text_20_body">From ProcessUntrusted()'s perspective, the start and end DIV tags are part of the untrusted content.</text:p>
<text:h text:style-name="Heading_20_4" text:outline-level="4">
<text:soft-page-break/>Displaying the Filtered Content</text:h>
<text:p text:style-name="Text_20_body">Once the content has been filtered, ProcessUntrusted() puts the filtered content into the DOM. <text:s/>To simplify this process and to ensure that all of the untrusted content and associated leading and trailing elements are removed from the DOM, the server provides an outer DIV element, like this:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T9">&lt;div&gt;</text:span>
<text:line-break/> &lt;!-- test comment --&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
</text:p>
<text:p text:style-name="P6">
<text:s text:c="2"/>try { NeatHtml.DefaultFilter.BeginUntrusted(); }<text:line-break/>
<text:s/>catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T10">
<text:s/>&lt;/script&gt; </text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="T10">&lt;div&gt;</text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="Variable">preprocessed untrusted content<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;/div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;NeatHtmlEndUntrusted</text:span>
</text:span> xmlns='http://www.brettle.com/neathtml/2008'<text:span text:style-name="Variable">
<text:span text:style-name="T3">/&gt;</text:span>
</text:span>
<text:span text:style-name="Variable"/>
<text:line-break/> &lt;!-- &gt; --&gt;<text:span text:style-name="T10">&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;</text:span>
<text:line-break/> &lt;script type='text/javascript'&gt;<text:line-break/>
<text:s/>NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/> &lt;/script&gt;<text:line-break/>
<text:span text:style-name="T9">&lt;/div&gt;</text:span>
</text:p>
<text:p text:style-name="Text_20_body">ProcessUntrusted() finds that DIV element by searching the ancestors of the script element that called BeginUntrusted() and stopping at the first DIV element. <text:s/>It then sets the innerHTML member of that DIV element to the filtered content.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Preventing Phishing and Containing Vandalism with Layout Lockdown</text:h>
<text:p text:style-name="Text_20_body">With the techniques described so far, users with script enabled will see the untrusted content after it has been filtered to prevent XSS and CSRF attacks. <text:s/>However, an attacker could still use styles (e.g. absolute positioning or negative margins) to display malicious content on any part of the page. <text:s/>This ability could be used vandalize the page or to launch a phishing attack in which the user is tricked into trusting the attacker's content because of where it appears on the page.</text:p>
<text:p text:style-name="Text_20_body">CSS provides a mechanism to restrict the area where content is displayed. <text:s/>If an element has the style “overflow: hidden”, then the browser is supposed to clip the content to the element's containing box. <text:s/>To take advantage of this, the server could style the outer DIV element, like this:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T10">&lt;div </text:span>
<text:span text:style-name="T9">style='overflow: hidden;'</text:span>
<text:span text:style-name="T10">&gt;</text:span>
<text:line-break/> &lt;!-- test comment --&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;<text:line-break/>
<text:s/>try { NeatHtml.DefaultFilter.BeginUntrusted(); }<text:line-break/>
<text:s/>catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }<text:line-break/> &lt;/script&gt; </text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="T10">&lt;div&gt;</text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="Variable">preprocessed untrusted content<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;/div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;NeatHtmlEndUntrusted</text:span>
</text:span> xmlns='http://www.brettle.com/neathtml/2008'<text:span text:style-name="Variable">
<text:span text:style-name="T3">/&gt;</text:span>
</text:span>
<text:span text:style-name="Variable"/>
<text:line-break/> &lt;!-- &gt; --&gt;<text:span text:style-name="T10">&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;</text:span>
<text:line-break/> &lt;script type='text/javascript'&gt;<text:line-break/>
<text:s/>NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/> &lt;/script&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;/div&gt;</text:span>
</text:p>
<text:p text:style-name="Text_20_body">That works in most browsers, but Internet Explorer 6 (IE6) and earlier do not hide overflow content unless the DIVs dimensions have been explicitly set either via a style or from script. <text:s/>To address this, the server adds a call to another NeatHtml JavaScript method: ResizeContainer(). <text:s text:c="2"/>On IE6 and earlier, ResizeContainer() sets the dimensions based on the computed dimensions of the filtered untrusted content.</text:p>
<text:p text:style-name="CodeExample">
<text:soft-page-break/>
<text:span text:style-name="T10">&lt;div style='overflow: hidden;'&gt;</text:span>
<text:line-break/> &lt;!-- test comment --&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
</text:p>
<text:p text:style-name="P6">
<text:s text:c="2"/>try { NeatHtml.DefaultFilter.BeginUntrusted(); }<text:line-break/>
<text:s/>catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T10">
<text:s/>&lt;/script&gt; </text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="T10">&lt;div&gt;</text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="Variable">preprocessed untrusted content<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;/div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;NeatHtmlEndUntrusted</text:span>
</text:span> xmlns='http://www.brettle.com/neathtml/2008'<text:span text:style-name="Variable">
<text:span text:style-name="T3">/&gt;</text:span>
</text:span>
<text:span text:style-name="Variable"/>
<text:line-break/> &lt;!-- &gt; --&gt;<text:span text:style-name="T10">&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;</text:span>
<text:line-break/> &lt;script type='text/javascript'&gt;<text:line-break/>
<text:s/>NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/> &lt;/script&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;/div&gt;<text:line-break/>
</text:span>
<text:span text:style-name="T9">&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ResizeContainer();<text:line-break/>&lt;/script&gt;</text:span>
</text:p>
<text:p text:style-name="Text_20_body">NeatHtml also does some additional styling which is not security related:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T10">&lt;div </text:span>
<text:span text:style-name="T9">class='NeatHtml' </text:span>
<text:span text:style-name="T10">style='overflow: hidden; </text:span>
<text:span text:style-name="T9">position: relative;<text:line-break/>
<text:s text:c="28"/>border: none; padding: 0; margin: 0;</text:span>
<text:span text:style-name="T10">'&gt;</text:span>
<text:line-break/> &lt;!-- test comment --&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T10">
<text:s/>try { NeatHtml.DefaultFilter.BeginUntrusted(); }<text:line-break/>
<text:s/>catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }<text:line-break/> &lt;/script&gt; </text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="T10">&lt;div&gt;</text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="Variable">preprocessed untrusted content<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;/div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;NeatHtmlEndUntrusted xmlns='http://www.brettle.com/neathtml/2008'/&gt;</text:span>
</text:span>
<text:span text:style-name="Variable"/>
<text:line-break/> &lt;!-- &gt; --&gt;<text:span text:style-name="T10">&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;</text:span>
<text:line-break/> &lt;script type='text/javascript'&gt;<text:line-break/>
<text:s/>NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/> &lt;/script&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;/div&gt;<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ResizeContainer();<text:line-break/>&lt;/script&gt;</text:span>
</text:p>
<text:p text:style-name="Text_20_body">The class attribute makes it easy for designers to style all untrusted content similarly (e.g. give it all the same background color). <text:s/>The “position: relative” allows for untrusted content to be positioned absolutely <text:span text:style-name="T5">within</text:span> the DIV. <text:s/>The “border: none; padding: 0; margin: 0”, simply make it easier for designers to style untrusted content by enclosing it in a separate DIV element for which they control all the style properties.</text:p>
<text:p text:style-name="Text_20_body">There is one other small way that the untrusted content could change something outside of the containing box. <text:s/>On browsers that support <text:a xlink:type="simple" xlink:href="http://www.w3.org/TR/CSS21/generate.html#counters">CSS counters</text:a> the untrusted content can use a style of “counter-increment: <text:span text:style-name="T5">counterName</text:span>” or “counter-reset: <text:span text:style-name="T5">counterName</text:span>” to change the values of counters. <text:s/>This could be used to change the numbering of paragraphs, chapters, etc. <text:s/>To avoid this, NeatHtml's client-side filter does not include “counter-increment” and “counter-reset” on the whitelist of property names.</text:p>
<text:h text:style-name="Heading_20_2" text:outline-level="2">Defending No-Script Users with Regex Replacements, Layout Lockdown, and a Table Trap</text:h>
<text:p text:style-name="Text_20_body">The techniques described above are designed to protect the overwhelming majority of users – those with JavaScript enabled. <text:s/>Protecting no-script users requires doing additional server-side preprocessing. <text:s/>NeatHtml tries to minimize the amount of server-side preprocessing while maximizing end-user security and usability. <text:s/>This section describes NeatHtml preprocessing techniques in general terms. <text:s/>See the <text:a xlink:type="simple" xlink:href="https://forgesvn1.novell.com/viewsvn/neathtml/trunk/dotnet/Brettle.Web.NeatHtml/Filter.cs?view=markup">Filter.cs</text:a> source code for <text:soft-page-break/>full details.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Sacrificing Well-Formedness</text:h>
<text:p text:style-name="Text_20_body">To maximize speed, NeatHtml's server-side component uses regular expressions (regexs) to manipulate the untrusted content directly as a string. <text:s/>This technique should be faster than the true parsing done by the client-side filter, especially for benign content. <text:s/>Unfortunately, the regex manipulations described below will not ensure that the preprocessed untrusted content parsed by the browser is well-formed XML. <text:s/>For example, no attempt is made to ensure that every start tag has a matching end tag, and named entities are not converted to numeric entities. <text:s/>For applications which require well-formed pages, the techniques described in this section are not appropriate. <text:s/>For those applications, options include:</text:p>
<text:list text:style-name="Bulleted_20_List">
<text:list-item text:start-value="1">
<text:p text:style-name="Bulleted_20_List">Sacrifice support for no-script users and Safari/Konqueror users by always hiding the preprocessed untrusted content in an HTML comment.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Require that untrusted content is well-formed and secure when it is created.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Use a server-side filter similar to NeatHtml's client-side filter. <text:s/>Porting NeatHtml's client-side filter to a server-side environment probably wouldn't be particularly difficult.</text:p>
</text:list-item>
</text:list>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Preventing Phishing and Containing Vandalism with Layout Lockdown and a Table Trap</text:h>
<text:p text:style-name="Text_20_body">Recall that the Layout Lockdown technique used for script users required calling the client-side function ResizeContainer() to ensure that overflow content was hidden from users of IE6 and earlier. <text:s/>Without script, NeatHtml needs to ensure that a fixed size scrollable outer DIV is used. <text:s/>To avoid affecting users of other browsers, the server uses a conditional comment, like this:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T9">&lt;!--[if gte IE 7]&gt;&lt;!--&gt;</text:span>
<text:span text:style-name="T10">
<text:line-break/>&lt;div class='NeatHtml' style='overflow: hidden; position: relative;<text:line-break/>
<text:s text:c="28"/>border: none; padding: 0; margin: 0;'&gt;<text:line-break/>
</text:span>
<text:span text:style-name="T9">&lt;!--&lt;![endif]--&gt;<text:line-break/>&lt;!--[if lt IE 7]&gt;<text:line-break/>&lt;div class='NeatHtml'<text:line-break/>
<text:s text:c="4"/>style='width: </text:span>
<text:span text:style-name="T6">NoScriptDownlevelIEWidth</text:span>
<text:span text:style-name="T9">; height: </text:span>
<text:span text:style-name="T6">NoScriptDownlevelIEHeight</text:span>
<text:span text:style-name="T9">;<text:line-break/>
<text:s text:c="11"/>overflow:auto; position:relative; border:none; padding:0; margin:0;'&gt;<text:line-break/>&lt;![endif]--&gt;</text:span>
<text:line-break/> &lt;!-- test comment --&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T10">
<text:s/>try { NeatHtml.DefaultFilter.BeginUntrusted(); }<text:line-break/>
<text:s/>catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }<text:line-break/> &lt;/script&gt; </text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="T10">&lt;div&gt;</text:span>
<text:line-break/>
<text:s/>
<text:span text:style-name="Variable">preprocessed untrusted content<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;/div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:line-break/>
<text:s/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;NeatHtmlEndUntrusted xmlns='http://www.brettle.com/neathtml/2008'/&gt;</text:span>
</text:span>
<text:span text:style-name="Variable"/>
<text:line-break/> &lt;!-- &gt; --&gt;<text:span text:style-name="T10">&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;</text:span>
<text:line-break/> &lt;script type='text/javascript'&gt;<text:line-break/>
<text:s/>NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/> &lt;/script&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;/div&gt;<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ResizeContainer();<text:line-break/>&lt;/script&gt;</text:span>
</text:p>
<text:p text:style-name="Text_20_body">The values <text:span text:style-name="T7">NoScriptDownlevelIEWidth</text:span>
<text:span text:style-name="T3">and <text:s/>
</text:span>
<text:span text:style-name="T7">NoScriptDownlevelIEHeight</text:span>
<text:span text:style-name="T3">are configurable, and default to “100%” and “400px” by default.</text:span>
</text:p>
<text:p text:style-name="P8">
<text:soft-page-break/>If the untrusted content is known to be well-formed and the containing page does not use CSS counters, the above technique is all that is needed to prevent phishing and contain all vandalism. <text:s/>Preventing CSS counter manipulation requires more complex server-side processing and is described in <text:a xlink:type="simple" xlink:href="#2.2.4.Preventing CSS Counter Manipulation|outline">section 2.2.4</text:a>. <text:s/>The remainder of this section describes the techniques the server uses to support ill-formed untrusted content.</text:p>
<text:p text:style-name="P8">To prevent untrusted content that leaves an attribute or tag half open (i.e. a missing quote or “&gt;”) from affecting trusted content, NeatHtml adds an empty single and double quoted attribute to the sentinel “&lt;NeatHtmlEndUntrusted /&gt;” element already being used to mark the end of untrusted content for the client-side script:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T10">&lt;!--[if gte IE 7]&gt;&lt;!--&gt; <text:line-break/>&lt;div class='NeatHtml' style='overflow: hidden; position: relative;<text:line-break/>
<text:s text:c="28"/>border: none; padding: 0; margin: 0;'&gt;<text:line-break/>&lt;!--&lt;![endif]--&gt;<text:line-break/>&lt;!--[if lt IE 7]&gt;<text:line-break/>&lt;div class='NeatHtml' <text:line-break/>
<text:s text:c="4"/>style='width: </text:span>
<text:span text:style-name="T7">NoScriptDownlevelIEWidth</text:span>
<text:span text:style-name="T10">; height: </text:span>
<text:span text:style-name="T7">NoScriptDownlevelIEHeight</text:span>
<text:span text:style-name="T10">;<text:line-break/>
<text:s text:c="11"/>overflow:auto; position:relative; border:none; padding:0; margin:0;'&gt;<text:line-break/>&lt;![endif]--&gt; </text:span>
<text:line-break/> &lt;!-- test comment --&gt;<text:line-break/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T10">
<text:s/>try { NeatHtml.DefaultFilter.BeginUntrusted(); }<text:line-break/>
<text:s/>catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }<text:line-break/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;/script&gt; <text:line-break/>
<text:s/>&lt;div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">
<text:line-break/>
<text:s/>
</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T7">preprocessed untrusted content<text:line-break/>
<text:s/>
</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;/div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable"/>
<text:span text:style-name="Variable">
<text:span text:style-name="T7">
<text:line-break/>
<text:s/>
</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;NeatHtmlEndUntrusted </text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T2">s='' d=""</text:span>
</text:span>
<text:span text:style-name="Variable"> xmlns='http://www.brettle.com/neathtml/2008'</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">/&gt;</text:span>
</text:span>
<text:span text:style-name="Variable"/>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">
<text:line-break/> &lt;!-- &gt; --&gt;&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;<text:line-break/> &lt;script type='text/javascript'&gt;<text:line-break/>
<text:s/>NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/> &lt;/script&gt;<text:line-break/> &lt;/div&gt;<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ResizeContainer();<text:line-break/>&lt;/script&gt;</text:span>
</text:span>
</text:p>
<text:p text:style-name="P8">As a result, a missing quote or “&gt;” would at most cause the inner DIV end tag and the sentinel element to be hidden from the browser. <text:s/>Since neither serves any security function, that is acceptable.</text:p>
<text:p text:style-name="P8">Next, consider untrusted content that tries to close the outer DIV element so that it can mount a phishing attack. <text:s/>To prevent this, NeatHtml uses a Table Trap. <text:s/>A Table Trap relies on the fact that modern browsers require TABLE elements to be explicitly closed. <text:s/>If a TABLE is enclosed in other elements, end tags for the enclosing elements are ignored as long as the TABLE element remains open. <text:s/>That means that the server can contain ill-formed untrusted content that does not contain TABLE end tags by enclosing it in a TABLE element, like below. <text:s/>Note: the styles associated with the TABLE and TD elements are simply to ensure that using this technique does not add any space around the untrusted content.</text:p>
<text:p text:style-name="CodeExample">
<text:soft-page-break/>
<text:span text:style-name="T10">&lt;!--[if gte IE 7]&gt;&lt;!--&gt;<text:line-break/>&lt;div class='NeatHtml' style='overflow: hidden; position: relative;<text:line-break/>
<text:s text:c="28"/>border: none; padding: 0; margin: 0;'&gt;<text:line-break/>&lt;!--&lt;![endif]--&gt;<text:line-break/>&lt;!--[if lt IE 7]&gt;<text:line-break/>&lt;div class='NeatHtml' <text:line-break/>
<text:s text:c="4"/>style='width: </text:span>
<text:span text:style-name="T7">NoScriptDownlevelIEWidth</text:span>
<text:span text:style-name="T10">; height: </text:span>
<text:span text:style-name="T7">NoScriptDownlevelIEHeight</text:span>
<text:span text:style-name="T10">;<text:line-break/>
<text:s text:c="11"/>overflow:auto; position:relative; border:none; padding:0; margin:0;'&gt;<text:line-break/>&lt;![endif]--&gt; </text:span>
<text:line-break/>
<text:span text:style-name="T9">&lt;table style='border-spacing: 0;'&gt;&lt;tr&gt;&lt;td style='padding: 0;'&gt;</text:span>
<text:line-break/>
<text:s/>&lt;!-- test comment --&gt;<text:line-break/>
<text:s/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T10">
<text:s text:c="2"/>try { NeatHtml.DefaultFilter.BeginUntrusted(); }<text:line-break/>
<text:s text:c="2"/>catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }<text:line-break/>
</text:span>
<text:span text:style-name="T3">
<text:s/>&lt;/script&gt; <text:line-break/>
<text:s text:c="2"/>&lt;div&gt; <text:line-break/>
<text:s text:c="2"/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T7">preprocessed untrusted content<text:line-break/>
<text:s text:c="2"/>
</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;/div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T7">
<text:line-break/>
<text:s text:c="2"/>
</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;NeatHtmlEndUntrusted s='' d=""</text:span>
</text:span> xmlns='http://www.brettle.com/neathtml/2008'<text:span text:style-name="Variable">
<text:span text:style-name="T3">/&gt;</text:span>
</text:span>
<text:span text:style-name="Variable"/>
<text:span text:style-name="T3">
<text:line-break/>
<text:s/>&lt;!-- &gt; --&gt;&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;<text:line-break/>
</text:span>
<text:span text:style-name="T2">&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</text:span>
</text:p>
<text:p text:style-name="P7">
<text:s/>&lt;script type='text/javascript'&gt;<text:line-break/>
<text:s/>NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/> &lt;/script&gt;<text:line-break/>&lt;/div&gt;<text:line-break/>&lt;script type='text/javascript'&gt;NeatHtml.DefaultFilter.ResizeContainer();&lt;/script&gt; </text:p>
<text:p text:style-name="P8">The Table Trap prevents untrusted content that doesn't contain TABLE end tags from displaying outside the outer DIV but does not prevent untrusted content from pulling trusted content <text:span text:style-name="T5">into</text:span> the outer DIV. <text:s/>In particular, if the untrusted content starts but does not end an IFRAME, OBJECT, SCRIPT, or CDATA element/section, then the trusted content which follows the outer DIV in the page will be pulled into the outer DIV and will appear to the user to be untrusted. <text:s/>This will occur because, like TABLE elements, the aforementioned elements must be explicitly closed. <text:s/>As a result the outer DIV's end tag will be ignored if such an element is still open. <text:s/>Although it's hard to imagine how such content could be used for phishing, it could certainly be used to vandalize the page. <text:s/>For that reason, the server closes any open SCRIPT elements, hides IFRAME and OBJECT tags, and disables CDATA sections as described below.</text:p>
<text:p text:style-name="P8">To close any open SCRIPT elements, the server simply adds an empty SCRIPT element after the untrusted content, like this:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T10">&lt;!--[if gte IE 7]&gt;&lt;!--&gt;<text:line-break/>&lt;div class='NeatHtml' style='overflow: hidden; position: relative;<text:line-break/>
<text:s text:c="28"/>border: none; padding: 0; margin: 0;'&gt;<text:line-break/>&lt;!--&lt;![endif]--&gt;<text:line-break/>&lt;!--[if lt IE 7]&gt;<text:line-break/>&lt;div class='NeatHtml' <text:line-break/>
<text:s text:c="4"/>style='width: </text:span>
<text:span text:style-name="T7">NoScriptDownlevelIEWidth</text:span>
<text:span text:style-name="T10">; height: </text:span>
<text:span text:style-name="T7">NoScriptDownlevelIEHeight</text:span>
<text:span text:style-name="T10">;<text:line-break/>
<text:s text:c="11"/>overflow:auto; position:relative; border:none; padding:0; margin:0;'&gt;<text:line-break/>&lt;![endif]--&gt; </text:span>
<text:line-break/>
<text:span text:style-name="T10">&lt;table style='border-spacing: 0;'&gt;&lt;tr&gt;&lt;td style='padding: 0;'&gt;</text:span>
<text:line-break/>
<text:s/>&lt;!-- test comment --&gt;<text:line-break/>
<text:s/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T10">
<text:s text:c="2"/>try { NeatHtml.DefaultFilter.BeginUntrusted(); }<text:line-break/>
<text:s text:c="2"/>catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }<text:line-break/>
</text:span>
<text:span text:style-name="T3">
<text:s/>&lt;/script&gt; <text:line-break/>
<text:s text:c="2"/>&lt;div&gt; <text:line-break/>
<text:s text:c="2"/>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T7">preprocessed untrusted content<text:line-break/>
<text:s text:c="2"/>
</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;/div&gt;</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T7">
<text:line-break/>
<text:s text:c="2"/>
</text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">&lt;NeatHtmlEndUntrusted s='' d=""</text:span>
</text:span> xmlns='http://www.brettle.com/neathtml/2008'<text:span text:style-name="Variable">
<text:span text:style-name="T3">/&gt;<text:line-break/>
<text:s text:c="2"/>
</text:span>
</text:span>
<text:span text:style-name="T2">&lt;script type=”text/javascript”&gt;&lt;/script&gt;</text:span>
<text:span text:style-name="T3">
<text:line-break/>
<text:s/>&lt;!-- &gt; --&gt;&lt;!-- &lt;xmp&gt;&lt;/xmp&gt;&lt;! --&gt;<text:line-break/> &lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;</text:span>
</text:p>
<text:p text:style-name="P7">
<text:soft-page-break/>
<text:s/>&lt;script type='text/javascript'&gt;<text:line-break/>
<text:s/>NeatHtml.DefaultFilter.ProcessUntrusted();<text:line-break/> &lt;/script&gt;<text:line-break/>&lt;/div&gt;<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ResizeContainer();<text:line-break/>&lt;/script&gt; </text:p>
<text:p text:style-name="Text_20_body">
<text:span text:style-name="T3">If the untrusted content leaves open a SCRIPT element the SCRIPT start tag above will be ignored (because <text:s/>SCRIPT elements are not allowed to nest) and the SCRIPT end tag will end the SCRIPT element started by the untrusted content.</text:span>
</text:p>
<text:p text:style-name="P8">To hide IFRAME and OBJECT tags, the server searches for all potential tags using the regex:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T9">&lt;(/)</text:span>?<text:span text:style-name="T9">([a-z][a-z0-9_:]*)?</text:span>
</text:p>
<text:p text:style-name="P8">The “(/)” group will match for all potential end tags and the “([a-z][a-z0-9_:]*)” group will match the tag name for any element tag. <text:s/>
</text:p>
<text:p text:style-name="P8">If there is a tag name but it is not on a whitelist (which would not contain TABLE, OBJECT, or IFRAME), the server prepends “NeatHtmlReplace_” to the tag name (e.g. “&lt;iframe” becomes “&lt;NeatHtmlReplace_iframe”). <text:s/>This effectively hides the tag from no-script users. <text:s/>When script is enabled, ProcessUntrusted() removes the “NeatHtmlReplace_” from the tag name, before filtering begins. <text:s/>In the current implementation everything on the client-side tag name whitelist is also on the server's whitelist, so renaming the tag is essentially the same as deleting it. <text:s/>However, renaming the tag leaves open the possibility of handling these elements differently when script is enabled.</text:p>
<text:p text:style-name="P8">Note: the tag name whitelist allows SCRIPT tags. <text:s/>Removing them from the whitelist would cause them to be renamed and as a result the script source code would be displayed to the user. <text:s/>While that isn't a security issue, it impacts usability. <text:s/>Having SCRIPT tags on the whitelist is not a security risk because no-script users won't run the scripts, and for scripting users the client-side filter will remove SCRIPT elements and their contents.</text:p>
<text:p text:style-name="Text_20_body">
<text:span text:style-name="T3">If no tag name is captured (e.g. “![CDATA[” does not match “([a-z][a-z0-9_:]*)”) the server disables the tag by replacing the initial “&lt;” with “&lt;NeatHtmlLt /&gt;&amp;lt;”. <text:s/>For no-script users, the browser ignores the “&lt;NeatHtmlLt /&gt;” and the user just sees “&lt;”. <text:s/>For script users, the “&lt;NeatHtmlLt /&gt;” allows ProcessUntrusted() to undo the replacement and pass the original untrusted content through the client-side filter. <text:s/>This gives the client-side filter a chance to handle any tags that did not match the server's regex.</text:span>
</text:p>
<text:p text:style-name="P8">The techniques described thus far should be sufficient to defend no-script users from phishing attacks and vandalism on pages that don't use CSS counters. <text:s/>The only drawbacks are:</text:p>
<text:list text:style-name="Bulleted_20_List">
<text:list-item text:start-value="1">
<text:p text:style-name="Bulleted_20_List">HTML comments in untrusted content will be displayed because “--” is replaced with “&amp;#34;&amp;#34;”</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">CDATA sections will be displayed because “&lt;![CDATA[” becomes “&lt;NeatHtmlLt /&gt;&amp;lt;![CDATA[”.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">TABLE, OBJECT, or IFRAME elements in untrusted content will not be displayed properly because the Table Trap technique described above renames those tags.</text:p>
</text:list-item>
</text:list>
<text:p text:style-name="P8">For applications where benign untrusted content is not expected to contain these types of markup, where CSS counters are not used, and where defending no-script users from CSRF attacks is not a requirement, the above techniques should be sufficient. <text:s/>For other applications, NeatHtml goes on to address these limitations, as described below.</text:p>
<text:h text:style-name="Heading_20_4" text:outline-level="4">
<text:soft-page-break/>Handling HTML Comments and CDATA Sections in Untrusted Content</text:h>
<text:p text:style-name="Text_20_body">Recall that the JavaScript Judo technique requires that the server replace all “--” with “&amp;#34;&amp;#34;”. <text:s/>Unfortunately, that replacement will cause any HTML comments in the untrusted content to be visible to no-script users. <text:s/>To reduce this problem, the server removes all strings matching:</text:p>
<text:p text:style-name="CodeExample">&lt;!--[^-]*(?:-[^-]+)*--&gt;</text:p>
<text:p text:style-name="Text_20_body">before replacing “--” with “&amp;34;&amp;34;”. <text:s/>That matches any HTML comment that does not contain “--”. <text:s/>Comments containing “--” are not removed by the server because matching them requires a considerably more complex regex. <text:s/>Since displaying such comments is not a security issue and the HTML standards discourage use of “--” in comments, NeatHtml avoids the additional complexity.</text:p>
<text:p text:style-name="Text_20_body">The server handles CDATA sections by replacing all complete CDATA sections with the HTML-encoded content of the CDATA section. <text:s/>A complete CDATA section is anything matching the following regex:</text:p>
<text:p text:style-name="CodeExample">&lt;!\[CDATA\[([^\]]*(?:\][^\]]+)*)\]\]&gt;</text:p>
<text:p text:style-name="P8">The content of the CDATA section (i.e. the part that the server HTML-encodes) is the part matching the first grouping construct.</text:p>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Allowing Tables in Untrusted Content</text:h>
<text:p text:style-name="Text_20_body">The algorithm used to allow tables has not been extensively tested and using it involves taking an unnecessary risk if benign content is not expected to contain TABLE elements. <text:s/>For that reason, support for displaying untrusted tables to no-script users is optional, and disabled by default.</text:p>
<text:p text:style-name="Text_20_body">When support for TABLE elements is enabled, NeatHtml keeps track of how many TABLE elements are open and closes any that remain open at the end of the untrusted content. <text:s/>This requires accurately identifying TABLE tags that will actually cause the browser to start or end a TABLE element. <text:s/>The regex used above to match potential tags, is not sufficient for the following reasons:</text:p>
<text:list text:style-name="Bulleted_20_List">
<text:list-item text:start-value="1">
<text:p text:style-name="Bulleted_20_List">It matches even if there is no closing “&gt;” or the tag is otherwise ill-formed.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">It matches in an attribute value.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">It matches even if it is within a SCRIPT element where a browser would not interpret it as a tag.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">It matches even if the tag occurs where a TABLE element is not allowed.</text:p>
</text:list-item>
</text:list>
<text:p text:style-name="Text_20_body">
<text:bookmark text:name="WellFormedTagRegex"/>NeatHtml attempts to address most of these situations by using the following regex instead:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T9">&lt;(/)</text:span>?(<text:span text:style-name="T9">([a-z][a-z0-9_:]*)</text:span>?(?:[ \t\n\r]+<text:span text:style-name="T9">([_:a-z][_:a-z0-9.]*)</text:span>((?:[ \t\n\r]*=[ \t\n\r]*<text:span text:style-name="T9">("[^&lt;"]*"|'[^&lt;']*'|[^"'][^ \t\n\r&lt;&gt;]*)</text:span>)?))*<text:span text:style-name="T9">([ \t\n\r]*/?&gt;)</text:span>?)</text:p>
<text:p text:style-name="Text_20_body">The groups in bold match/capture different parts of the tag as follows:</text:p>
<table:table table:name="Table1" table:style-name="Table1">
<table:table-column table:style-name="Table1.A"/>
<table:table-column table:style-name="Table1.B"/>
<text:soft-page-break/>
<table:table-row>
<table:table-cell table:style-name="Table1.A1" office:value-type="string">
<text:p text:style-name="Table_20_Heading">Group</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table1.B1" office:value-type="string">
<text:p text:style-name="Table_20_Heading">Description</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table1.A2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">
<text:span text:style-name="Source_20_Text">
<text:span text:style-name="T11">(/)</text:span>
</text:span>
<text:span text:style-name="Example"/>
</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table1.B2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">Matches for end tags.</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table1.A2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">
<text:span text:style-name="Source_20_Text">
<text:span text:style-name="T11">([a-z][a-z0-9_:]*)</text:span>
</text:span>
</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table1.B2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">Captures the tag name.</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table1.A2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">
<text:span text:style-name="Source_20_Text">
<text:span text:style-name="T11">([_:a-z][_:a-z0-9.]*)</text:span>
</text:span>
</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table1.B2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">Captures each attribute name. <text:s/>Each regex match would have one capture for each attribute in the tag.</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table1.A2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">
<text:span text:style-name="Source_20_Text">
<text:span text:style-name="T11">("[^&lt;"]*"|'[^&lt;']*'|[^"'][^ \t\n\r&lt;&gt;]*)</text:span>
</text:span>
</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table1.B2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">Captures the attribute value. <text:s/>Each regex match would have one capture for each attribute value in the tag. <text:s/>The attribute value must be a single quoted string, a double quoted string, or an unquoted string that contains neither whitespace nor angle brackets.</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table1.A2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">
<text:span text:style-name="Source_20_Text">
<text:span text:style-name="T11">([ \t\n\r]*/?&gt;)</text:span>
</text:span>
</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table1.B2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">Captures the part of the tag after the last attribute, referred to below as the “tag tail”. <text:s/>The tag tail includes any trailing whitespace, followed by either “/&gt;” or just “&gt;”. </text:p>
</table:table-cell>
</table:table-row>
</table:table>
<text:p text:style-name="Text_20_body">The server continues to disable tags when there is no tag name, and additionally disables tags if there is no tag tail, or if there are attributes on an end tag, or an end tag ends with “/&gt;”. <text:s/>The server disables the tag by replacing the initial “&lt;” with “&lt;NeatHtmlLt /&gt;&amp;lt;” as described earlier. <text:s/>The server also continues to rename tags that are not on a whitelist, by prepending “NeatHtmlReplace_” to the tag name as described earlier. <text:s/>Additionally, the server canonicalizes attributes by quoting any unquoted attribute values, and adding attribute values wherever they are missing.</text:p>
<text:p text:style-name="Text_20_body">The above regex manipulations result in preprocessed untrusted content where all tags are whitelisted and well-formed (i.e. all attributes have valid names and a quoted value that does not contain “&lt;”). <text:s/>This makes it possible to accurately identify well-formed TABLE tags, but those tags could still occur:</text:p>
<text:list text:style-name="Bulleted_20_List">
<text:list-item text:start-value="1">
<text:p text:style-name="Bulleted_20_List">within a SCRIPT element where a browser would not interpret it as a tag, or</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">where a TABLE element is not allowed</text:p>
</text:list-item>
</text:list>
<text:p text:style-name="Text_20_body">Based on limited testing, TABLE elements appear to be allowed almost anywhere within the body of a document. <text:s/>The only apparent exception is that they are not allowed inside of another TABLE element unless they are also inside of a cell (i.e. TD or TH) within that TABLE element. <text:s/>To account for this, NeatHtml keeps track of how many allowed TABLE elements are currently open, and whether a TABLE start tag is currently allowed. <text:s/>A TABLE start tag is only allowed if the most recent TABLE-related tag was a TD or TH start tag, or an allowed TABLE end tag (i.e. where an allowed TABLE element was closed), or no TABLE elements are open. <text:s/>To ensure that SCRIPT elements can't be used to hide TABLE start or end tags or TD or TH start tags, NeatHtml inserts “&lt;script&gt;&lt;/script&gt;” before those tags to force closed any open SCRIPT elements. <text:s/>If NeatHtml encounters a TABLE start or end tag where it is not allowed, it prefixes the tag name with “NeatHtmlReplace_” to disable the tag.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">
<text:soft-page-break/>Removing Automated CSRF Attacks by Disabling Suspicious Tags and Attributes</text:h>
<text:p text:style-name="Text_20_body">To remove automated CSRF attacks, the server uses the same <text:a xlink:type="simple" xlink:href="#WellFormedTagRegex">regex used to identify well-formed tags</text:a>, but uses a more restrictive tag name whitelist (e.g. IMG tags are not allowed), disables any attributes whose name is not on a whitelist (e.g. BACKGROUND is not allowed), and disables any style attributes containing property names not on a whitelist (e.g. background-image is not allowed) or containing a suspicious property value. <text:s/>The server disables attributes by appending “_NeatHtmlReplace” to the attribute name. <text:s/>That effectively hides the attribute from non-script users. <text:s text:c="2"/>When script is enabled, the client-side filter removes the “_NeatHtmlReplace” from the end of the attribute name before filtering it. <text:s/>This gives the client-side filter a chance to handle any attributes that the server cannot. <text:s/>In particular, the client-side filter can remove individual style properties that are not whitelisted, instead of disabling the entire style attribute.</text:p>
<text:p text:style-name="Text_20_body">To inspect style property names and property values, the server uses the following regex:</text:p>
<text:p text:style-name="CodeExample">^(?: *<text:span text:style-name="T9">(-?[_a-z][_a-z0-9-]*)</text:span> *:<text:span text:style-name="T9">(?:\((?&lt;=rgb\()|[ -%')-9&lt;-[\]-~])*</text:span>(?:;|$))*$</text:p>
<text:p text:style-name="Text_20_body">That matches a style attribute value only if the value is a sequence of declarations. <text:s/>Each declaration must consist of a property name optionally surrounded by spaces, followed by a “:”, an allowed property value and an optional “;”. <text:s/>The server compares the captured property names against a whitelist, disabling the entire attribute if one is not on the list. <text:s/>Note that allowed property values can contain only the following characters:</text:p>
<text:list text:style-name="Bulleted_20_List">
<text:list-item text:start-value="1">
<text:p text:style-name="Bulleted_20_List">the space character</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">“(“ only if it is immediately preceded by “rgb”. <text:s/>This prevents “url()” from being used for an CSRF attack.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Bulleted_20_List">Any other printable ASCII characters except “&amp;”, “:”, “;”, and “\”. <text:s/>The character “&amp;” is not allowed because it can be used to HTML-encode characters and the character “\” is not allowed because it is used to start escape sequences in styles. <text:s/>Both are potential security risks because they could be used to put characters in the property value that are not otherwise allowed. <text:s/>The characters “:” and “;” are not allowed because they could conceivably confuse a browser's style parser if they are found in a style property value.</text:p>
</text:list-item>
</text:list>
<text:p text:style-name="Text_20_body">The allowed style value regex is designed to match the overwhelming majority of benign styles seen in typical HTML markup, while not matching any styles that could contain automated CSRF attacks. <text:s/>In those cases where a benign styles does not match the regex, no-script users see the associated content, but with no style applied.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Preventing CSS Counter Manipulation</text:h>
<text:p text:style-name="Text_20_body">Recall that untrusted content can use “counter-reset” or “counter-increment” to manipulate CSS counters that are used by trusted content. <text:s/>To ensure that trusted content can use CSS counters securely, the property name whitelist used by the server to remove CSRF attacks, does not contain those properties.</text:p>
<text:h text:style-name="Heading_20_2" text:outline-level="2">Preventing NeatHtml from Being Used for Denial of Service Attacks</text:h>
<text:p text:style-name="Text_20_body">Consider an attack that use pathological untrusted content in an attempt to mount a DoS attack against either the server or the user's browser. <text:s/>Specifically, content which contains a very large number of “&lt;” characters, or a very large number of attributes might take the server or ProcessUntrusted() a long time to process. <text:s/>
<text:soft-page-break/>Additionally, content with a large number of “&amp;” characters can take ProcessUntrusted() a long time to process. <text:s/>NeatHtml was designed to take time proportional to the size of the untrusted content, but the constant of proportionality can be high for the cases just mentioned. <text:s/>Processing is slow in these cases because they cause a large number of regex matches and subsequent function calls. <text:s/>To address this, NeatHtml tracks the number of regex matches that have occurred, and stops processing when a configurable limit is exceeded. <text:s/>By default, the limit is 10000.</text:p>
<text:h text:style-name="Heading_20_1" text:outline-level="1">Future Work</text:h>
<text:p text:style-name="Text_20_body">This section describes ways that NeatHtml could be extended or improved. <text:s/>Potential performance improvements are discussed as well as additional functionality.</text:p>
<text:h text:style-name="Heading_20_2" text:outline-level="2">Improving Server-Side Performance</text:h>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Making Style Checking Optional</text:h>
<text:p text:style-name="Text_20_body">Removing CSRF attacks and preventing CSS counter manipulation requires that the server check all style property names and values. <text:s/>To improve performance for applications where preventing those attacks is not a requirement, that processing should be made optional.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Avoiding No-Script Processing When JavaScript Is Enabled</text:h>
<text:p text:style-name="Text_20_body">Almost all of NeatHtml's server-side processing is dedicated to protecting no-script users. <text:s/>If the server knows that the user has JavaScript enabled, the all of that work can be skipped. <text:s/>To determine that a user has JavaScript enabled, NeatHtml could use JavaScript on a page to set a cookie. <text:s/>To detect if these users later disable JavaScript, a NOSCRIPT element can be used. <text:s/>The NOSCRIPT element would contain an image and/or a link to a page. <text:s/>The server would delete the cookie when the image or page was retrieved. </text:p>
<text:p text:style-name="Text_20_body">When the server detected the cookie indicating JavaScript was enabled, it would place the untrusted content in a JavaScript string - escaping quotes and newlines appropriately - and send something like this to the browser:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T10">&lt;div class='NeatHtml' style='overflow: hidden; position: relative;<text:line-break/>
<text:s text:c="28"/>border: none; padding: 0; margin: 0; '&gt; </text:span>
<text:line-break/>
<text:span text:style-name="T10">&lt;script type='text/javascript'&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T10">
<text:s/>try { </text:span>
<text:span text:style-name="T9">NeatHtml.DefaultFilter.ProcessUntrusted('</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T9">escaped untrusted content</text:span>
</text:span>
<text:span text:style-name="T9">');</text:span>
<text:span text:style-name="T10">}<text:line-break/>
<text:s/>catch (ex) { document.writeln('NeatHtml not found\074!-' + '-'); }<text:line-break/> &lt;/script&gt;<text:line-break/>
</text:span>
<text:span text:style-name="T9">&lt;noscript&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T9">
<text:s/>&lt;a target=”_blank” href=”</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T9">RemoveScriptEnabledCookiePageURL</text:span>
</text:span>
<text:span text:style-name="T9">”<text:line-break/>
<text:s text:c="2"/>&gt;&lt;img src=”</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T9">RemoveScriptEnabledCookieImageURL</text:span>
</text:span>
<text:span text:style-name="T9">” <text:line-break/>
<text:s text:c="7"/>alt='Click here and then...' <text:line-break/>
<text:s/>/&gt;&lt;/a&gt;<text:line-break/>
<text:s/>Please reload this page to view without JavaScript enabled.<text:line-break/> &lt;/noscript&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T10">&lt;/div&gt;<text:line-break/>&lt;script type='text/javascript'&gt;<text:line-break/> NeatHtml.DefaultFilter.ResizeContainer();<text:line-break/>&lt;/script&gt;</text:span>
</text:p>
<text:p text:style-name="Text_20_body">
<text:soft-page-break/>If JavaScript was still enabled, ProcessUntrusted() would replace the contents of the containing DIV element with the filtered untrusted content.</text:p>
<text:p text:style-name="Text_20_body">If the user had disabled JavaScript, the exact behavior would depend on how the browser handled images. <text:s/>If the user's browser automatically downloaded images, it would retrieve a 1x1 transparent GIF from <text:span text:style-name="Variable">
<text:span text:style-name="T10">RemoveScriptEnabledCookieImageURL – </text:span>
</text:span>
<text:span text:style-name="Variable">
<text:span text:style-name="T3">allowing the server to delete the cookie –</text:span>
</text:span>
<text:span text:style-name="T10">and the user would be asked to reload the page. <text:s/>If the</text:span> user's browser did not automatically retrieve images, the user would be asked to click a link before reloading the page. <text:s/>The link would display <text:span text:style-name="Variable">
<text:span text:style-name="T10">RemoveScriptEnabledCookiePageURL</text:span>
</text:span> in a new window which would allow the server to delete the cookie.</text:p>
<text:h text:style-name="Heading_20_2" text:outline-level="2">Adding New Features and Ports</text:h>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Discouraging Link Spam</text:h>
<text:p text:style-name="Text_20_body">
<text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Spamdexing#Link_spam">Link spam</text:a> is more of an annoyance than a security threat, but NeatHtml is in a position to discourage it. <text:s/>Since NeatHtml parses attribute names and values, it could ensure that any tag with an HREF attribute had a REL attribute with a value of “nofollow”. <text:s/>Since the major search engines don't consider <text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Nofollow">nofollow</text:a> links when computing rankings, this would remove one of the largest incentives for link spam. <text:s/>It would not prevent link spam entirely though. <text:s/>Some spammers do not check whether links are marked as “nofollow” and some hope that normal users will follow the links even if search engine spiders don't.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Improving CSRF Removal</text:h>
<text:p text:style-name="Text_20_body">NeatHtml currently removes automated CSRF attacks by removing anything that could cause the browser to make a secondary request, including images. <text:s/>Unfortunately, that approach removes benign images from untrusted content and does not address user-initiated CSRF attacks where a user is tricked into clicking a link designed to launch a CSRF attack.</text:p>
<text:p text:style-name="Text_20_body">Most CSRF attacks rely on the fact that the user's cookies are sent to the target site. <text:s/>
<text:a xlink:type="simple" xlink:href="http://tools.ietf.org/html/rfc2965">RFC 2965</text:a> states that cookies must not be sent on cross-domain redirects. <text:s/>If browsers actually follow that rule, it should be possible to prevent all CSRF attacks that rely on cookies by changing URLs in untrusted content so that they go through a cross-domain redirector.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Supporting Inline Untrusted Content</text:h>
<text:p text:style-name="Text_20_body">NeatHtml currently displays untrusted content in a DIV element. <text:s/>Browsers display DIV elements as CSS blocks by default. <text:s/>As a result, the only way to use NeatHtml to handle untrusted HTML that should be displayed inline is to treat the entire block element that contains the untrusted content as untrusted, even though much of it may be trusted. <text:s/>In addition to being inconvenient, this also allows the untrusted content to mount phishing and vandalism attacks on the trusted content in the block.</text:p>
<text:p text:style-name="Text_20_body">It is worth investigating whether untrusted content could be displayed inline by styling the DIV element to use “display: inline” instead. <text:s/>It's not clear whether overflow would be hidden by the browser, particularly if the browser is IE6 or earlier.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">
<text:soft-page-break/>Running Untrusted Scripts in a Restricted Environment</text:h>
<text:p text:style-name="Text_20_body">For some applications, it would be desirable to allow untrusted scripts to run if their capabilities could be restricted. <text:s/>This would be particularly valuable for <text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Mashup_(web_application_hybrid)">mashup</text:a> applications and social networking sites. <text:s/>Since NeatHtml can modify an untrusted script before it runs, it might be able to create a restricted environment for these scripts. <text:s/>For example, NeatHtml could do the following:</text:p>
<text:list text:style-name="Numbered_20_List">
<text:list-item>
<text:p text:style-name="Numbered_20_List">Use a regex to find all potential global identifiers in the script. <text:s/>False positives would not impact functionality or security (as long as the matches are syntactically valid identifiers), so this regex could be fairly liberal.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Numbered_20_List">Enclose the script in a function declaration, and before the function declaration add local (i.e. “var”) declarations for all the global identifiers that are not on a whitelist. <text:s/>This hides those global objects from the untrusted script. <text:s/>For whitelisted identifiers, NeatHtml could provide a proxy object. <text:s/>The proxy object would be responsible for restricting access to the underlying global object. <text:s/>For example, the proxy object for the built-in global eval() function would treat it's string parameter as an untrusted script, processing it the same as an untrusted top-level script before passing it to the built-in eval() function. <text:s/>The proxy for the Function object constructor would work the same way.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Numbered_20_List">Convert the resulting script to a quoted JavaScript string (e.g. escaping quotes and newlines), try to pass quoted string to the Function object constructor, and call the newly constructed function. <text:s/>This would provide a way to catch syntax and execution errors in the untrusted script.</text:p>
</text:list-item>
</text:list>
<text:p text:style-name="Text_20_body">With the above technique, the following script:</text:p>
<text:p text:style-name="CodeExample">window.alert('XSS');</text:p>
<text:p text:style-name="CodeExample">eval(“ale” + “rt('XSS');”);<text:line-break/>(new Function(“ale” + “rt('XSS');”))();</text:p>
<text:p text:style-name="Text_20_body">would become:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T9">try {<text:line-break/>
<text:s/>(new Function(“”<text:line-break/>
<text:s text:c="3"/>+ “ <text:s/>var window = null;\n”<text:line-break/>
<text:s text:c="3"/>+ “ <text:s/>var eval = EvalProxy;\n”<text:line-break/>
<text:s text:c="3"/>+ “ <text:s/>var Function = FunctionProxy;\n”<text:line-break/>
<text:s text:c="3"/>+ “ <text:s/>RunUntrustedScript();\n”<text:line-break/>
<text:line-break/>
<text:s text:c="3"/>+ “ <text:s/>function RunUntrustedScript</text:span>
<text:span text:style-name="T9">() {\n”</text:span>
<text:span text:style-name="T9">
<text:line-break/>
</text:span>
<text:s text:c="3"/>
<text:span text:style-name="T9">+ “</text:span>
<text:s text:c="3"/>window.alert('XSS');<text:span text:style-name="T9">\n”</text:span>
<text:line-break/>
<text:s text:c="3"/>
<text:span text:style-name="T9">+ “</text:span>
<text:s text:c="3"/>eval(<text:span text:style-name="T9">\</text:span>“ale\” + <text:span text:style-name="T9">\</text:span>“rt('XSS');<text:span text:style-name="T9">\</text:span>”);<text:span text:style-name="T9">\n”</text:span>
<text:line-break/>
<text:s text:c="3"/>
<text:span text:style-name="T9">+ “</text:span>
<text:s text:c="3"/>(new Function(<text:span text:style-name="T9">\</text:span>“ale<text:span text:style-name="T9">\</text:span>” + <text:span text:style-name="T9">\</text:span>“rt('XSS');<text:span text:style-name="T9">\</text:span>”))();<text:span text:style-name="T9">\n”</text:span>
<text:span text:style-name="T9">
<text:line-break/>
<text:s text:c="3"/>+ “ <text:s/>}\n”</text:span>
<text:span text:style-name="T9">
<text:line-break/>
<text:s/>)();<text:line-break/>}<text:line-break/>catch (ex) { <text:s/>/* Optionally handle errors */ }</text:span>
</text:p>
<text:p text:style-name="Text_20_body">Unfortunately, there is at least one problem with the above technique. <text:s/>Although it hides the global eval() function behind a proxy, it is not able to hide the deprecated eval() <text:span text:style-name="T5">method</text:span> that exists for every object. <text:s/>It's not clear how hard it would be to address that. <text:s/>It might be as easy as calling something like “Object.prototype.eval = EvalProxy”. <text:s/>However, if that isn't sufficient, the solution would be considerably more complicated and would probably look something like this:</text:p>
<text:list text:style-name="Numbered_20_List">
<text:list-item text:start-value="1">
<text:p text:style-name="Numbered_20_List">Remove all comments.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Numbered_20_List">Split the script into code, quoted strings, and regexs.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Numbered_20_List">In code portions of the script, replace the regex “\.[ \t\r\n]*eval” with “.EvalProxy” to prevent <text:soft-page-break/>access to the eval method with the dot operator.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Numbered_20_List">In code portions of the script, find all “[” characters that are used to access object properties instead of start array literals.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="Numbered_20_List">Replace the aforementioned “[” characters with “[NeatHtml.Eval2EvalProxy(” and replace the matching “]” characters with “)]”. <text:s text:c="2"/>That would make:<text:line-break/>
<text:span text:style-name="Source_20_Text">x[“ev”+”al”]</text:span>
<text:line-break/>become:<text:line-break/>
<text:span text:style-name="Source_20_Text">x[NeatHtml.Eval2EvalProxy(“ev”+”al”)]</text:span>
</text:p>
</text:list-item>
</text:list>
<text:p text:style-name="Text_20_body">In addition to restricting object access, the filter could also try to restrict CPU usage of the untrusted script. <text:s text:c="3"/>That is a considerably more complex problem, especially if the untrusted script is allowed to use regular expressions.</text:p>
<text:p text:style-name="Text_20_body">Despite these challenges, using NeatHtml to restrict untrusted scripts is a goal worth pursuing, primarily because it would not require any changes to the software installed on the user's computer.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Porting the Server-Side Code to Other Environments</text:h>
<text:p text:style-name="Text_20_body">NeatHtml's current server-side component is written for ASP.NET, but it designed to be small and simple, so that it is easy to port to other development environments. <text:s/>This means that in addition to NeatHtml for ASP.NET, it should be easy to create NeatHtml for Java, NeatHtml for PHP, etc.</text:p>
<text:p text:style-name="Text_20_body">Other types of ports would also be interesting. <text:s/>First, consider a port that could be plugged into the web server (e.g. NeatHtml for Apache, or NeatHtml for IIS) to filter HTTP responses as they were sent to the browser. <text:s/>To allow the add-on to find the untrusted content in the HTTP responses, developers would only need to mark it like securely, perhaps like this:</text:p>
<text:p text:style-name="CodeExample">&lt;NeatHtmlBeginRawUntrusted token=”<text:span text:style-name="Variable">token</text:span>” /&gt;<text:line-break/>
<text:span text:style-name="Variable">raw untrusted content</text:span>
<text:line-break/>&lt;NeatHtmlEndRawUntrusted token=”<text:span text:style-name="Variable">token</text:span>” /&gt;</text:p>
<text:p text:style-name="Text_20_body">where <text:span text:style-name="T5">token</text:span> would be any value that the author of the untrusted content could not determine before submitting the content. <text:s/>This would ensure that the untrusted content couldn't forge the “&lt;NeatHtmlEndRawUntrusted&gt;” tag to get content past the add-on.</text:p>
<text:p text:style-name="Text_20_body">If marking untrusted content in such a way became common enough, the server-side code could be ported to proxy server or browser add-ons. <text:s/>Such add-ons would allow users to protect themselves while requiring no additional server-side computational resources and a minimum amount of application developer effort.</text:p>
<text:p text:style-name="Text_20_body"/>
</office:text>
</office:body>
</office:document>
