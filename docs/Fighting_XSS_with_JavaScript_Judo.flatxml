<?xml version="1.0" encoding="UTF-8"?>
<office:document xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:style="urn:oasis:names:tc:opendocument:xmlns:style:1.0" xmlns:text="urn:oasis:names:tc:opendocument:xmlns:text:1.0" xmlns:table="urn:oasis:names:tc:opendocument:xmlns:table:1.0" xmlns:draw="urn:oasis:names:tc:opendocument:xmlns:drawing:1.0" xmlns:fo="urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:number="urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0" xmlns:svg="urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0" xmlns:chart="urn:oasis:names:tc:opendocument:xmlns:chart:1.0" xmlns:dr3d="urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="urn:oasis:names:tc:opendocument:xmlns:form:1.0" xmlns:script="urn:oasis:names:tc:opendocument:xmlns:script:1.0" xmlns:config="urn:oasis:names:tc:opendocument:xmlns:config:1.0" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" office:version="1.0" office:mimetype="application/x-vnd.oasis.openoffice.text">
<office:meta>
<meta:generator>OpenOffice.org/2.0$Linux OpenOffice.org_project/680m5$Build-9073</meta:generator>
<dc:title>Fighting Cross Site Scripting (XSS) with Some Javascript Judo</dc:title>
<meta:creation-date>2007-09-14T11:03:22</meta:creation-date>
<dc:creator>Dean Brettle</dc:creator>
<dc:date>2007-09-16T12:09:37</dc:date>
<dc:language>en-US</dc:language>
<meta:editing-cycles>18</meta:editing-cycles>
<meta:editing-duration>P1DT10H47M14S</meta:editing-duration>
<meta:user-defined meta:name="Info 1"/>
<meta:user-defined meta:name="Info 2"/>
<meta:user-defined meta:name="Info 3"/>
<meta:user-defined meta:name="Info 4"/>
<meta:document-statistic meta:table-count="2" meta:image-count="0" meta:object-count="0" meta:page-count="1" meta:paragraph-count="77" meta:word-count="2336" meta:character-count="15281"/>
</office:meta>
<office:settings>
<config:config-item-set config:name="ooo:view-settings">
<config:config-item config:name="ViewAreaTop" config:type="int">1002</config:config-item>
<config:config-item config:name="ViewAreaLeft" config:type="int">1002</config:config-item>
<config:config-item config:name="ViewAreaWidth" config:type="int">32651</config:config-item>
<config:config-item config:name="ViewAreaHeight" config:type="int">20930</config:config-item>
<config:config-item config:name="ShowRedlineChanges" config:type="boolean">false</config:config-item>
<config:config-item config:name="InBrowseMode" config:type="boolean">true</config:config-item>
<config:config-item-map-indexed config:name="Views">
<config:config-item-map-entry>
<config:config-item config:name="ViewId" config:type="string">view2</config:config-item>
<config:config-item config:name="ViewLeft" config:type="int">24735</config:config-item>
<config:config-item config:name="ViewTop" config:type="int">7791</config:config-item>
<config:config-item config:name="VisibleLeft" config:type="int">1002</config:config-item>
<config:config-item config:name="VisibleTop" config:type="int">1002</config:config-item>
<config:config-item config:name="VisibleRight" config:type="int">33651</config:config-item>
<config:config-item config:name="VisibleBottom" config:type="int">21930</config:config-item>
<config:config-item config:name="ZoomType" config:type="short">0</config:config-item>
<config:config-item config:name="ZoomFactor" config:type="short">100</config:config-item>
<config:config-item config:name="IsSelectedFrame" config:type="boolean">false</config:config-item>
</config:config-item-map-entry>
</config:config-item-map-indexed>
</config:config-item-set>
<config:config-item-set config:name="ooo:configuration-settings">
<config:config-item config:name="AddParaTableSpacing" config:type="boolean">true</config:config-item>
<config:config-item config:name="PrintReversed" config:type="boolean">false</config:config-item>
<config:config-item config:name="OutlineLevelYieldsNumbering" config:type="boolean">false</config:config-item>
<config:config-item config:name="LinkUpdateMode" config:type="short">1</config:config-item>
<config:config-item config:name="PrintEmptyPages" config:type="boolean">true</config:config-item>
<config:config-item config:name="IgnoreFirstLineIndentInNumbering" config:type="boolean">false</config:config-item>
<config:config-item config:name="CharacterCompressionType" config:type="short">0</config:config-item>
<config:config-item config:name="PrintSingleJobs" config:type="boolean">false</config:config-item>
<config:config-item config:name="UpdateFromTemplate" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintPaperFromSetup" config:type="boolean">false</config:config-item>
<config:config-item config:name="AddFrameOffsets" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintLeftPages" config:type="boolean">true</config:config-item>
<config:config-item config:name="RedlineProtectionKey" config:type="base64Binary"/>
<config:config-item config:name="PrintTables" config:type="boolean">true</config:config-item>
<config:config-item config:name="ChartAutoUpdate" config:type="boolean">true</config:config-item>
<config:config-item config:name="PrintControls" config:type="boolean">true</config:config-item>
<config:config-item config:name="PrinterSetup" config:type="base64Binary">YgH+/0dlbmVyaWMgUHJpbnRlcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU0dFTlBSVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWAAMAqAAAAAAA//8FAFZUAAAkbQAASm9iRGF0YSAxCnByaW50ZXI9R2VuZXJpYyBQcmludGVyCm9yaWVudGF0aW9uPVBvcnRyYWl0CmNvcGllcz0xCnNjYWxlPTEwMAptYXJnaW5kYWp1c3RtZW50PTAsMCwwLDAKY29sb3JkZXB0aD0yNApwc2xldmVsPTAKY29sb3JkZXZpY2U9MApQUERDb250ZXhEYXRhClBhZ2VTaXplOkxldHRlcgAA</config:config-item>
<config:config-item config:name="IgnoreTabsAndBlanksForLineCalculation" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintAnnotationMode" config:type="short">0</config:config-item>
<config:config-item config:name="LoadReadonly" config:type="boolean">false</config:config-item>
<config:config-item config:name="AddParaSpacingToTableCells" config:type="boolean">true</config:config-item>
<config:config-item config:name="AddExternalLeading" config:type="boolean">true</config:config-item>
<config:config-item config:name="ApplyUserData" config:type="boolean">true</config:config-item>
<config:config-item config:name="FieldAutoUpdate" config:type="boolean">true</config:config-item>
<config:config-item config:name="SaveVersionOnClose" config:type="boolean">false</config:config-item>
<config:config-item config:name="SaveGlobalDocumentLinks" config:type="boolean">false</config:config-item>
<config:config-item config:name="IsKernAsianPunctuation" config:type="boolean">false</config:config-item>
<config:config-item config:name="AlignTabStopPosition" config:type="boolean">true</config:config-item>
<config:config-item config:name="ClipAsCharacterAnchoredWriterFlyFrames" config:type="boolean">false</config:config-item>
<config:config-item config:name="CurrentDatabaseDataSource" config:type="string"/>
<config:config-item config:name="DoNotCaptureDrawObjsOnPage" config:type="boolean">false</config:config-item>
<config:config-item config:name="TableRowKeep" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrinterName" config:type="string">Generic Printer</config:config-item>
<config:config-item config:name="PrintFaxName" config:type="string"/>
<config:config-item config:name="ConsiderTextWrapOnObjPos" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintRightPages" config:type="boolean">true</config:config-item>
<config:config-item config:name="IsLabelDocument" config:type="boolean">false</config:config-item>
<config:config-item config:name="UseFormerLineSpacing" config:type="boolean">false</config:config-item>
<config:config-item config:name="AddParaTableSpacingAtStart" config:type="boolean">true</config:config-item>
<config:config-item config:name="UseFormerTextWrapping" config:type="boolean">false</config:config-item>
<config:config-item config:name="DoNotResetParaAttrsForNumFont" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintProspect" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintGraphics" config:type="boolean">true</config:config-item>
<config:config-item config:name="AllowPrintJobCancel" config:type="boolean">true</config:config-item>
<config:config-item config:name="CurrentDatabaseCommandType" config:type="int">0</config:config-item>
<config:config-item config:name="DoNotJustifyLinesWithManualBreak" config:type="boolean">false</config:config-item>
<config:config-item config:name="UseFormerObjectPositioning" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrinterIndependentLayout" config:type="string">high-resolution</config:config-item>
<config:config-item config:name="UseOldNumbering" config:type="boolean">false</config:config-item>
<config:config-item config:name="PrintPageBackground" config:type="boolean">true</config:config-item>
<config:config-item config:name="CurrentDatabaseCommand" config:type="string"/>
<config:config-item config:name="PrintDrawings" config:type="boolean">true</config:config-item>
<config:config-item config:name="PrintBlackFonts" config:type="boolean">false</config:config-item>
</config:config-item-set>
</office:settings>
<office:scripts>
<office:script script:language="ooo:Basic">
<ooo:libraries>
<ooo:library-embedded ooo:name="Standard"/>
</ooo:libraries>
</office:script>
</office:scripts>
<office:font-face-decls>
<style:font-face style:name="StarSymbol" svg:font-family="StarSymbol"/>
<style:font-face style:name="Nimbus Mono L" svg:font-family="'Nimbus Mono L'" style:font-family-generic="modern" style:font-pitch="fixed"/>
<style:font-face style:name="Arial Unicode MS" svg:font-family="'Arial Unicode MS'" style:font-pitch="variable"/>
<style:font-face style:name="HG Mincho Light J" svg:font-family="'HG Mincho Light J'" style:font-pitch="variable"/>
<style:font-face style:name="Nimbus Roman No9 L" svg:font-family="'Nimbus Roman No9 L'" style:font-family-generic="roman" style:font-pitch="variable"/>
<style:font-face style:name="Thorndale" svg:font-family="Thorndale" style:font-family-generic="roman" style:font-pitch="variable"/>
<style:font-face style:name="Albany" svg:font-family="Albany" style:font-family-generic="swiss" style:font-pitch="variable"/>
<style:font-face style:name="DejaVu LGC Sans" svg:font-family="'DejaVu LGC Sans'" style:font-family-generic="system" style:font-pitch="variable"/>
</office:font-face-decls>
<office:styles>
<style:default-style style:family="graphic">
<style:graphic-properties draw:shadow-offset-x="0.1181in" draw:shadow-offset-y="0.1181in" draw:start-line-spacing-horizontal="0.1114in" draw:start-line-spacing-vertical="0.1114in" draw:end-line-spacing-horizontal="0.1114in" draw:end-line-spacing-vertical="0.1114in" style:flow-with-text="true"/>
<style:paragraph-properties style:text-autospace="ideograph-alpha" style:line-break="strict" style:writing-mode="lr-tb" style:font-independent-line-spacing="false">
<style:tab-stops/>
</style:paragraph-properties>
<style:text-properties style:use-window-font-color="true" fo:font-size="12pt" fo:language="en" fo:country="US" style:font-size-asian="12pt" style:language-asian="en" style:country-asian="US" style:font-size-complex="12pt" style:language-complex="en" style:country-complex="US"/>
</style:default-style>
<style:default-style style:family="paragraph">
<style:paragraph-properties fo:hyphenation-ladder-count="no-limit" style:text-autospace="ideograph-alpha" style:punctuation-wrap="hanging" style:line-break="strict" style:tab-stop-distance="0.4925in" style:writing-mode="page"/>
<style:text-properties style:use-window-font-color="true" style:font-name="Nimbus Roman No9 L" fo:font-size="12pt" fo:language="en" fo:country="US" style:font-name-asian="DejaVu LGC Sans" style:font-size-asian="12pt" style:language-asian="en" style:country-asian="US" style:font-name-complex="DejaVu LGC Sans" style:font-size-complex="12pt" style:language-complex="en" style:country-complex="US" fo:hyphenate="false" fo:hyphenation-remain-char-count="2" fo:hyphenation-push-char-count="2"/>
</style:default-style>
<style:default-style style:family="table">
<style:table-properties table:border-model="collapsing"/>
</style:default-style>
<style:default-style style:family="table-row">
<style:table-row-properties fo:keep-together="auto"/>
</style:default-style>
<style:style style:name="Standard" style:family="paragraph" style:class="text"/>
<style:style style:name="Text_20_body" style:display-name="Text body" style:family="paragraph" style:parent-style-name="Standard" style:class="text">
<style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0.1965in"/>
</style:style>
<style:style style:name="Heading" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Text_20_body" style:class="text">
<style:paragraph-properties fo:margin-top="0.1665in" fo:margin-bottom="0.1965in" fo:keep-with-next="always"/>
<style:text-properties style:font-name="Albany" fo:font-size="14pt" style:font-name-asian="HG Mincho Light J" style:font-size-asian="14pt" style:font-name-complex="Arial Unicode MS" style:font-size-complex="14pt"/>
</style:style>
<style:style style:name="Heading_20_1" style:display-name="Heading 1" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text" style:default-outline-level="1">
<style:text-properties style:font-name="Thorndale" fo:font-size="24pt" fo:font-weight="bold" style:font-name-asian="HG Mincho Light J" style:font-size-asian="24pt" style:font-weight-asian="bold" style:font-name-complex="Arial Unicode MS" style:font-size-complex="24pt" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Heading_20_2" style:display-name="Heading 2" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text" style:default-outline-level="2">
<style:text-properties style:font-name="Nimbus Roman No9 L" fo:font-size="18pt" fo:font-weight="bold" style:font-name-asian="DejaVu LGC Sans" style:font-size-asian="18pt" style:font-weight-asian="bold" style:font-name-complex="DejaVu LGC Sans" style:font-size-complex="18pt" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Heading_20_3" style:display-name="Heading 3" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text" style:default-outline-level="3">
<style:text-properties style:font-name="Nimbus Roman No9 L" fo:font-size="14pt" fo:font-weight="bold" style:font-name-asian="DejaVu LGC Sans" style:font-size-asian="14pt" style:font-weight-asian="bold" style:font-name-complex="DejaVu LGC Sans" style:font-size-complex="14pt" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Heading_20_4" style:display-name="Heading 4" style:family="paragraph" style:parent-style-name="Heading" style:next-style-name="Text_20_body" style:class="text" style:default-outline-level="4">
<style:text-properties fo:font-size="85%" fo:font-style="italic" fo:font-weight="bold" style:font-size-asian="85%" style:font-style-asian="italic" style:font-weight-asian="bold" style:font-size-complex="85%" style:font-style-complex="italic" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="List" style:family="paragraph" style:parent-style-name="Text_20_body" style:class="list"/>
<style:style style:name="Header" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
<style:paragraph-properties text:number-lines="false" text:line-number="0">
<style:tab-stops>
<style:tab-stop style:position="3.3457in" style:type="center"/>
<style:tab-stop style:position="6.6925in" style:type="right"/>
</style:tab-stops>
</style:paragraph-properties>
</style:style>
<style:style style:name="Footer" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
<style:paragraph-properties text:number-lines="false" text:line-number="0">
<style:tab-stops>
<style:tab-stop style:position="3.3457in" style:type="center"/>
<style:tab-stop style:position="6.6925in" style:type="right"/>
</style:tab-stops>
</style:paragraph-properties>
</style:style>
<style:style style:name="Table_20_Contents" style:display-name="Table Contents" style:family="paragraph" style:parent-style-name="Text_20_body" style:class="extra"/>
<style:style style:name="Table_20_Heading" style:display-name="Table Heading" style:family="paragraph" style:parent-style-name="Table_20_Contents" style:class="extra">
<style:paragraph-properties fo:text-align="center" style:justify-single-word="false" text:number-lines="false" text:line-number="0"/>
<style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="Caption" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
<style:paragraph-properties fo:margin-top="0.0835in" fo:margin-bottom="0.0835in" text:number-lines="false" text:line-number="0"/>
<style:text-properties fo:font-size="12pt" fo:font-style="italic" style:font-size-asian="12pt" style:font-style-asian="italic" style:font-size-complex="12pt" style:font-style-complex="italic"/>
</style:style>
<style:style style:name="Sender" style:family="paragraph" style:parent-style-name="Standard" style:class="extra">
<style:text-properties fo:font-style="italic"/>
</style:style>
<style:style style:name="Index" style:family="paragraph" style:parent-style-name="Standard" style:class="index">
<style:paragraph-properties text:number-lines="false" text:line-number="0"/>
</style:style>
<style:style style:name="Preformatted_20_Text" style:display-name="Preformatted Text" style:family="paragraph" style:parent-style-name="Standard" style:class="html">
<style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0in"/>
<style:text-properties style:font-name="Nimbus Mono L" fo:font-size="10pt" style:font-name-asian="Nimbus Mono L" style:font-size-asian="10pt" style:font-name-complex="Nimbus Mono L" style:font-size-complex="10pt"/>
</style:style>
<style:style style:name="Horizontal_20_Line" style:display-name="Horizontal Line" style:family="paragraph" style:parent-style-name="Standard" style:next-style-name="Text_20_body" style:class="html">
<style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0.1965in" style:border-line-width-bottom="0.0008in 0.0138in 0.0008in" fo:padding="0in" fo:border-left="none" fo:border-right="none" fo:border-top="none" fo:border-bottom="0.0154in double #808080"/>
<style:text-properties fo:font-size="6pt"/>
</style:style>
<style:style style:name="Heading_20_3.Untrusted" style:display-name="Heading 3.Untrusted" style:family="paragraph" style:parent-style-name="Heading_20_3"/>
<style:style style:name="CodeExample" style:family="paragraph" style:parent-style-name="Preformatted_20_Text">
<style:paragraph-properties fo:margin-left="0.4925in" fo:margin-right="0in" fo:margin-top="0in" fo:margin-bottom="0.2in" fo:text-indent="0in" style:auto-text-indent="false" fo:background-color="#e6e6e6">
<style:background-image/>
</style:paragraph-properties>
</style:style>
<style:style style:name="Footnote_20_Symbol" style:display-name="Footnote Symbol" style:family="text"/>
<style:style style:name="Numbering_20_Symbols" style:display-name="Numbering Symbols" style:family="text"/>
<style:style style:name="Bullet_20_Symbols" style:display-name="Bullet Symbols" style:family="text">
<style:text-properties style:font-name="StarSymbol" fo:font-size="9pt" style:font-name-asian="StarSymbol" style:font-size-asian="9pt" style:font-name-complex="StarSymbol" style:font-size-complex="9pt"/>
</style:style>
<style:style style:name="Internet_20_link" style:display-name="Internet link" style:family="text">
<style:text-properties fo:color="#000080" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/>
</style:style>
<style:style style:name="Visited_20_Internet_20_Link" style:display-name="Visited Internet Link" style:family="text">
<style:text-properties fo:color="#800000" style:text-underline-style="solid" style:text-underline-width="auto" style:text-underline-color="font-color"/>
</style:style>
<style:style style:name="Endnote_20_Symbol" style:display-name="Endnote Symbol" style:family="text"/>
<style:style style:name="Emphasis" style:family="text">
<style:text-properties fo:font-style="italic" style:font-style-asian="italic" style:font-style-complex="italic"/>
</style:style>
<style:style style:name="Source_20_Text" style:display-name="Source Text" style:family="text">
<style:text-properties style:font-name="Nimbus Mono L" style:font-name-asian="Nimbus Mono L" style:font-name-complex="Nimbus Mono L"/>
</style:style>
<style:style style:name="Variable" style:family="text">
<style:text-properties fo:font-style="italic" style:font-style-asian="italic" style:font-style-complex="italic"/>
</style:style>
<style:style style:name="Frame" style:family="graphic">
<style:graphic-properties text:anchor-type="paragraph" svg:x="0in" svg:y="0in" style:wrap="parallel" style:number-wrapped-paragraphs="no-limit" style:wrap-contour="false" style:vertical-pos="top" style:vertical-rel="paragraph-content" style:horizontal-pos="center" style:horizontal-rel="paragraph-content"/>
</style:style>
<style:style style:name="Graphics" style:family="graphic">
<style:graphic-properties text:anchor-type="paragraph" svg:x="0in" svg:y="0in" style:wrap="none" style:vertical-pos="top" style:vertical-rel="paragraph" style:horizontal-pos="center" style:horizontal-rel="paragraph"/>
</style:style>
<style:style style:name="OLE" style:family="graphic">
<style:graphic-properties text:anchor-type="paragraph" svg:x="0in" svg:y="0in" style:wrap="none" style:vertical-pos="top" style:vertical-rel="paragraph" style:horizontal-pos="center" style:horizontal-rel="paragraph"/>
</style:style>
<text:outline-style>
<text:outline-level-style text:level="1" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
<text:outline-level-style text:level="2" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
<text:outline-level-style text:level="3" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
<text:outline-level-style text:level="4" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
<text:outline-level-style text:level="5" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
<text:outline-level-style text:level="6" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
<text:outline-level-style text:level="7" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
<text:outline-level-style text:level="8" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
<text:outline-level-style text:level="9" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
<text:outline-level-style text:level="10" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:outline-level-style>
</text:outline-style>
<text:notes-configuration text:note-class="footnote" style:num-format="1" text:start-value="0" text:footnotes-position="page" text:start-numbering-at="document"/>
<text:notes-configuration text:note-class="endnote" style:num-format="i" text:start-value="0"/>
<text:linenumbering-configuration text:number-lines="false" text:offset="0.1965in" style:num-format="1" text:number-position="left" text:increment="5"/>
</office:styles>
<office:automatic-styles>
<style:style style:name="Table1" style:family="table">
<style:table-properties style:width="7.8181in" fo:margin-left="0.491in" table:align="left"/>
</style:style>
<style:style style:name="Table1.A" style:family="table-column">
<style:table-column-properties style:column-width="1.4743in"/>
</style:style>
<style:style style:name="Table1.B" style:family="table-column">
<style:table-column-properties style:column-width="6.3438in"/>
</style:style>
<style:style style:name="Table1.A1" style:family="table-cell">
<style:table-cell-properties style:vertical-align="middle" style:border-line-width-left="0.0007in 0.0347in 0.0007in" style:border-line-width-top="0.0007in 0.0347in 0.0007in" style:border-line-width-bottom="0.0007in 0.0347in 0.0007in" fo:padding="0.0194in" fo:border-left="0.0361in double #808080" fo:border-right="none" fo:border-top="0.0361in double #808080" fo:border-bottom="0.0361in double #808080"/>
</style:style>
<style:style style:name="Table1.B1" style:family="table-cell">
<style:table-cell-properties style:vertical-align="middle" style:border-line-width="0.0007in 0.0347in 0.0007in" fo:padding="0.0194in" fo:border="0.0361in double #808080"/>
</style:style>
<style:style style:name="Table1.A2" style:family="table-cell">
<style:table-cell-properties style:vertical-align="middle" style:border-line-width-left="0.0007in 0.0347in 0.0007in" style:border-line-width-bottom="0.0007in 0.0347in 0.0007in" fo:padding="0.0194in" fo:border-left="0.0361in double #808080" fo:border-right="none" fo:border-top="none" fo:border-bottom="0.0361in double #808080"/>
</style:style>
<style:style style:name="Table1.B2" style:family="table-cell">
<style:table-cell-properties style:vertical-align="middle" style:border-line-width-left="0.0007in 0.0347in 0.0007in" style:border-line-width-right="0.0007in 0.0347in 0.0007in" style:border-line-width-bottom="0.0007in 0.0347in 0.0007in" fo:padding="0.0194in" fo:border-left="0.0361in double #808080" fo:border-right="0.0361in double #808080" fo:border-top="none" fo:border-bottom="0.0361in double #808080"/>
</style:style>
<style:style style:name="Table2" style:family="table">
<style:table-properties style:width="12.959in" table:align="left"/>
</style:style>
<style:style style:name="Table2.A" style:family="table-column">
<style:table-column-properties style:column-width="1.2431in"/>
</style:style>
<style:style style:name="Table2.B" style:family="table-column">
<style:table-column-properties style:column-width="5.4826in"/>
</style:style>
<style:style style:name="Table2.C" style:family="table-column">
<style:table-column-properties style:column-width="6.2333in"/>
</style:style>
<style:style style:name="Table2.A1" style:family="table-cell">
<style:table-cell-properties style:vertical-align="middle" style:border-line-width-left="0.0007in 0.0347in 0.0007in" style:border-line-width-top="0.0007in 0.0347in 0.0007in" style:border-line-width-bottom="0.0007in 0.0347in 0.0007in" fo:padding="0.0194in" fo:border-left="0.0361in double #808080" fo:border-right="none" fo:border-top="0.0361in double #808080" fo:border-bottom="0.0361in double #808080"/>
</style:style>
<style:style style:name="Table2.C1" style:family="table-cell">
<style:table-cell-properties style:vertical-align="middle" style:border-line-width="0.0007in 0.0347in 0.0007in" fo:padding="0.0194in" fo:border="0.0361in double #808080"/>
</style:style>
<style:style style:name="Table2.A2.1.1" style:family="table-cell">
<style:table-cell-properties style:vertical-align="middle" style:border-line-width-left="0.0007in 0.0347in 0.0007in" style:border-line-width-bottom="0.0007in 0.0347in 0.0007in" fo:padding="0.0194in" fo:border-left="0.0361in double #808080" fo:border-right="none" fo:border-top="none" fo:border-bottom="0.0361in double #808080"/>
</style:style>
<style:style style:name="Table2.C2" style:family="table-cell">
<style:table-cell-properties style:vertical-align="middle" style:border-line-width-left="0.0007in 0.0347in 0.0007in" style:border-line-width-right="0.0007in 0.0347in 0.0007in" style:border-line-width-bottom="0.0007in 0.0347in 0.0007in" fo:padding="0.0194in" fo:border-left="0.0361in double #808080" fo:border-right="0.0361in double #808080" fo:border-top="none" fo:border-bottom="0.0361in double #808080"/>
</style:style>
<style:style style:name="P1" style:family="paragraph" style:parent-style-name="Heading_20_1" style:master-page-name="HTML"/>
<style:style style:name="P2" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L2">
<style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0in"/>
</style:style>
<style:style style:name="P3" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L2"/>
<style:style style:name="P4" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L3">
<style:paragraph-properties fo:margin-top="0in" fo:margin-bottom="0in"/>
</style:style>
<style:style style:name="P5" style:family="paragraph" style:parent-style-name="Text_20_body" style:list-style-name="L3"/>
<style:style style:name="P6" style:family="paragraph" style:parent-style-name="Table_20_Contents">
<style:text-properties fo:font-size="2pt" style:font-size-asian="2pt" style:font-size-complex="2pt"/>
</style:style>
<style:style style:name="T1" style:family="text">
<style:text-properties fo:font-weight="bold"/>
</style:style>
<style:style style:name="T2" style:family="text">
<style:text-properties fo:font-style="italic"/>
</style:style>
<style:style style:name="T3" style:family="text">
<style:text-properties fo:font-style="italic" style:font-style-asian="italic" style:font-style-complex="italic"/>
</style:style>
<style:style style:name="T4" style:family="text">
<style:text-properties fo:font-weight="bold" style:font-weight-asian="bold" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="T5" style:family="text" style:parent-style-name="Variable">
<style:text-properties fo:font-style="normal" fo:font-weight="bold" style:font-style-asian="normal" style:font-weight-asian="bold" style:font-style-complex="normal" style:font-weight-complex="bold"/>
</style:style>
<style:style style:name="T6" style:family="text">
<style:text-properties fo:font-weight="bold"/>
</style:style>
<text:list-style style:name="L1">
<text:list-level-style-number text:level="1" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="2" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="3" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="4" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="5" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="6" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="7" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="8" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="9" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="10" style:num-format="">
<style:list-level-properties text:min-label-distance="0.15in"/>
</text:list-level-style-number>
</text:list-style>
<text:list-style style:name="L2">
<text:list-level-style-bullet text:level="1" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="0.2945in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="2" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="0.7854in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="3" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="1.2764in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="4" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="1.7673in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="5" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="2.2583in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="6" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="2.7492in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="7" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="3.2402in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="8" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="3.7315in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="9" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="4.2224in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
<text:list-level-style-bullet text:level="10" text:style-name="Bullet_20_Symbols" style:num-suffix="." text:bullet-char="•">
<style:list-level-properties text:space-before="4.7134in" text:min-label-width="0.1965in"/>
<style:text-properties style:font-name="StarSymbol"/>
</text:list-level-style-bullet>
</text:list-style>
<text:list-style style:name="L3">
<text:list-level-style-number text:level="1" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="0.2945in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="2" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="0.7854in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="3" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="1.2764in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="4" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="1.7673in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="5" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="2.2583in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="6" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="2.7492in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="7" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="3.2402in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="8" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="3.7315in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="9" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="4.2224in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
<text:list-level-style-number text:level="10" text:style-name="Numbering_20_Symbols" style:num-suffix="." style:num-format="1">
<style:list-level-properties text:space-before="4.7134in" text:min-label-width="0.1965in"/>
</text:list-level-style-number>
</text:list-style>
<style:page-layout style:name="pm1">
<style:page-layout-properties fo:page-width="8.5in" fo:page-height="11in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="1in" fo:margin-bottom="1in" fo:margin-left="1.25in" fo:margin-right="1.25in" style:writing-mode="lr-tb" style:footnote-max-height="0in">
<style:footnote-sep style:width="0.0071in" style:distance-before-sep="0.0398in" style:distance-after-sep="0.0398in" style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
</style:page-layout-properties>
<style:header-style/>
<style:footer-style/>
</style:page-layout>
<style:page-layout style:name="pm2">
<style:page-layout-properties fo:page-width="8.5in" fo:page-height="11in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="0.3937in" fo:margin-bottom="0.3937in" fo:margin-left="0.7874in" fo:margin-right="0.3937in" fo:background-color="transparent" style:writing-mode="lr-tb" style:footnote-max-height="0in">
<style:background-image/>
<style:footnote-sep style:width="0.0071in" style:distance-before-sep="0.0398in" style:distance-after-sep="0.0398in" style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
</style:page-layout-properties>
<style:header-style/>
<style:footer-style/>
</style:page-layout>
<style:page-layout style:name="pm3">
<style:page-layout-properties fo:page-width="8.5in" fo:page-height="11in" style:num-format="1" style:print-orientation="portrait" fo:margin-top="1in" fo:margin-bottom="1in" fo:margin-left="1.25in" fo:margin-right="1.25in" style:writing-mode="lr-tb" style:footnote-max-height="0in">
<style:footnote-sep style:adjustment="left" style:rel-width="25%" style:color="#000000"/>
</style:page-layout-properties>
<style:header-style/>
<style:footer-style/>
</style:page-layout>
<number:date-style style:name="N37" number:automatic-order="true">
<number:month number:style="long"/>
<number:text>/</number:text>
<number:day number:style="long"/>
<number:text>/</number:text>
<number:year/>
</number:date-style>
<number:time-style style:name="N106">
<number:hours number:style="long"/>
<number:text>:</number:text>
<number:minutes number:style="long"/>
<number:text>:</number:text>
<number:seconds number:style="long"/>
<number:am-pm/>
</number:time-style>
</office:automatic-styles>
<office:master-styles>
<style:master-page style:name="Standard" style:page-layout-name="pm1"/>
<style:master-page style:name="HTML" style:page-layout-name="pm2"/>
<style:master-page style:name="Endnote" style:page-layout-name="pm3"/>
</office:master-styles>
<office:body>
<office:text>
<office:forms form:automatic-focus="false" form:apply-design-mode="false"/>
<text:sequence-decls>
<text:sequence-decl text:display-outline-level="0" text:name="Illustration"/>
<text:sequence-decl text:display-outline-level="0" text:name="Table"/>
<text:sequence-decl text:display-outline-level="0" text:name="Text"/>
<text:sequence-decl text:display-outline-level="0" text:name="Drawing"/>
</text:sequence-decls>
<text:h text:style-name="P1" text:outline-level="1">NeatHtml: Fighting Cross Site Scripting (XSS) with JavaScript Judo</text:h>
<text:p text:style-name="Text_20_body">
<text:span text:style-name="Emphasis">by </text:span>
<text:a xlink:type="simple" xlink:href="http://www.brettle.com/">
<text:span text:style-name="Emphasis">Dean Brettle</text:span>
</text:a>
<text:a xlink:type="simple" xlink:href="http://www.brettle.com/"/>
<text:span text:style-name="Emphasis">(Last updated </text:span>
<text:span text:style-name="Emphasis">
<text:date style:data-style-name="N37" text:date-value="2007-09-14T11:19:30" text:fixed="true">09/14/07</text:date>
</text:span>
<text:span text:style-name="Emphasis"/>
<text:span text:style-name="Emphasis">
<text:time style:data-style-name="N106" text:time-value="2007-09-14T11:19:40" text:fixed="true">11:19:40AM</text:time>
</text:span>
<text:span text:style-name="Emphasis"> )</text:span>
</text:p>
<text:h text:style-name="Heading_20_2" text:outline-level="2" text:is-list-header="true">Overview</text:h>
<text:p text:style-name="Text_20_body">
<text:a xlink:type="simple" xlink:href="http://www.brettle.com/neathtml">NeatHtml™</text:a> is a highly-portable <text:a xlink:type="simple" xlink:href="http://www.opensource.org/">open source</text:a> website component that displays untrusted content securely, efficiently, and accessibly. <text:s/>Untrusted content is any content that is not trusted by the website owner. <text:s/>Typical examples include blog comments, forum posts, or user pages social networking sites. <text:s/>NeatHtml focuses on preventing <text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Xss">Cross-Site Scripting</text:a> (XSS) attacks but is also able to prevent (or greatly limit the value of) zero-click <text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Cross_site_request_forgery">Cross-Site Request Forgery</text:a> (XSRF) attacks and <text:a xlink:type="simple" xlink:href="http://en.wikipedia.org/wiki/Phishing">phishing</text:a> attacks. <text:s/>NeatHtml uses an “accept only known good” (whitelist) approach to security to help prevent attacks which are not yet known. <text:s text:c="2"/>To minimize server load, the server only needs to do a few regular expression replacements. The bulk of the work is done using JavaScript on the client. I call this technique "JavaScript Judo" because it uses the source of an attacker's power (i.e. JavaScript) against him. The JavaScript Judo technique was inspired by <text:a xlink:type="simple" xlink:href="http://www.mindedsecurity.com/">Stefano Di Paola's</text:a> work on <text:a xlink:type="simple" xlink:href="http://www.wisec.it/sectou.php?id=46c5843ea4900">Preventing XSS with Data Binding</text:a>. <text:s/>The primary disadvantage to the data binding approach is that the untrusted content is removed from the normal document flow. <text:s/>This causes accessibility problems for users who disable script and for search engine spiders. <text:s/>NeatHtml avoids this problem by leaving the untrusted content in the document flow but using JavaScript to hide it from the browser until it has been filtered. <text:s/>As a result, users who disable script (and search engine spiders) see untrusted content normally. NeatHtml uses server-side style and markup techniques to defend no-script users from XSRF and phishing attacks.</text:p>
<text:p text:style-name="Text_20_body">NeatHtml consists of the NeatHtml.js JavaScript library and a small server-side component for ASP.NET. <text:s/>The server-side component is only approximately 350 lines of code and should be easy to port to other web development platforms. <text:s/>To facilitate porting and testing, NeatHtml includes a JavaScript test framework and a <text:a xlink:type="simple" xlink:href="http://www.brettle.com/NeatHtml/dotnet/Demo.aspx">demo page</text:a> which uses the test framework and demonstrates the capabilities of NeatHtml. <text:s/>NeatHtml is licensed under the <text:a xlink:type="simple" xlink:href="http://www.gnu.org/copyleft/lesser.html#TOC1">
<text:span text:style-name="T1">Lesser</text:span>
</text:a>
<text:a xlink:type="simple" xlink:href="http://www.gnu.org/copyleft/lesser.html#TOC1"> General Public License (LGPL)</text:a>, a business-friendly <text:a xlink:type="simple" xlink:href="http://opensource.org/docs/definition.php">open source</text:a> license.</text:p>
<text:p text:style-name="Text_20_body">NeatHtml should work with any browser that supports JavaScript 1.3 or later and a few DOM APIs. It does <text:span text:style-name="T2">not</text:span> use the browser's internal XML/HTML parser to parse the untrusted content, thereby eliminating many browser compatibility issues. It has been tested against: </text:p>
<text:list text:style-name="L2">
<text:list-item>
<text:p text:style-name="P2">Microsoft Internet Explorer (IE) version 7.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P2">Microsoft Internet Explorer (IE) version 6. <text:s/>When script is disabled, the untrusted content is displayed in a fixed size div (with scroll bars if necessary). This is necessary to prevent absolutely positioned untrusted content from displaying outside the box. </text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P2">Mozilla Firefox (FF) versions 1.5 and 2.0.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P2">Opera 9.21.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P2">Netscape 7.2.</text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P2">Mac Safari versions 1.2, 1.3, and 2.0. </text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P2">Windows Safari version 3.0.2. </text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P3">Konqueror 3.4.0-5 and 3.5.7. </text:p>
</text:list-item>
</text:list>
<text:h text:style-name="Heading_20_2" text:outline-level="2" text:is-list-header="true">
<text:bookmark text:name="Details"/>Technical Details</text:h>
<text:p text:style-name="Text_20_body">This section describes the various techniques that NeatHtml uses. <text:s/>To simplify the presentation, the problem is broken into smaller subproblems and the techniques used to address each of the subproblems is described. <text:s/>NeatHtml uses all of the techniques in combination, other solutions could use a subset of the techniques to address a subset of the problems. <text:s/>For example, if the untrusted content is an entire user page on a social networking site, preventing phishing and vandalism might not be a concern and the associated techniques would not need to be applied.</text:p>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Defending Most Users with JavaScript Judo and Layout Lockdown</text:h>
<text:p text:style-name="Text_20_body">As of January 2007, approximately <text:a xlink:type="simple" xlink:href="http://www.w3schools.com/browsers/browsers_stats.asp">94% of users have JavaScript enabled</text:a>. <text:s/>Defenses which rely on JavaScript obviously directly protect users that have JavaScript enabled. <text:s/>Such defenses <text:span text:style-name="T3">also</text:span> indirectly protect no-script users by reducing the expected value of a non-targeted attack by a factor of almost 20. <text:s/>NeatHtml uses the techniques described in this section to achieve these benefits. <text:s/>It also uses other techniques, described later, to directly protect non-script users.</text:p>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Preventing XSS and Zero-Click XSRF with JavaScript Judo</text:h>
<text:p text:style-name="Text_20_body">To prevent XSS and zero-click XSRF, the untrusted content must be filtered before the browser interprets it as HTML. <text:s/>To prevent XSS, the filter must at least address SCRIPT elements, on<text:span text:style-name="Variable">Event</text:span> attributes, and expression() calls in inline styles. <text:s/>To prevent Zero-Click XSRF, the filter must at least address IMG, IFRAME, and OBJECT elements, url() calls in inline styles. <text:s/>This filtering is normally performed on the server, using either a blacklist or a whitelist approach. <text:s/>The blacklist approach typically produces less load on the server but is less secure than a whitelist approach. <text:s/>A true whitelist approach requires parsing the untrusted content (both the HTML and it's inline styles) before passing it to the browser. <text:s/>Such parsing produces enough load on the server that it may not be practical to do the parsing each time the untrusted content is sent to the browser. <text:s/>Filtering the untrusted content when it is created would solve the load problem, but has it's own disadvantages. <text:s/>It is generally more complicated to implement because the type of filtering required can vary over time and across users. <text:s/>For example, it might be desirable to let the content's author (or an administrator) see their unfiltered content for editing (or auditing) purposes. <text:s/>Or, a bug might need to be fixed in the filter and all previously filtered content would need to be refiltered. <text:s/>Keeping track of which content has been filtered with which filter can add significant complexity to an application. <text:s/>That complexity can be especially onerous when trying to secure existing applications.</text:p>
<text:p text:style-name="Text_20_body">To avoid the above issues, NeatHtml does most of it's filtering using JavaScript in the browser. <text:s/>This means that the untrusted content must be hidden from the browsers HTML parser until it has been filtered. <text:s/>One way to achieve this is to enclose the untrusted content in an HTML comment and then use JavaScript to extract it, filter it, and replace the comment with the result. <text:s/>Before doing this, the server must replace all “--” with “&amp;#34;&amp;#34;” in the untrusted content. <text:s/>That preprocessing ensures that the comment is not ended prematurely. <text:s/>The preprocessing is undone by the JavaScript code before the untrusted content is filtered. <text:s/>The result is below. <text:s/>The ProcessUntrusted() method is responsible for extracting the preprocessed untrusted content, undoing the preprocessing, filtering the untrusted content, and replacing the comment with the filtered result.</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T4">&lt;!-- </text:span>
<text:span text:style-name="Variable">preprocessed untrusted content </text:span>
<text:span text:style-name="T4">--&gt;</text:span>
<text:line-break/>
<text:span text:style-name="T4">&lt;script type='text/javascript'&gt;NeatHtml.DefaultFilter.ProcessUntrusted();&lt;/script&gt;</text:span>
</text:p>
<text:p text:style-name="Text_20_body">This works well in most browsers, but fails in Safari and Konqueror because those browsers don't provide access to comments from JavaScript. <text:s/>An alternative is to enclose the untrusted content in an XMP element (after removing or replacing “&lt;/xmp&gt;”), like this:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T4">&lt;xmp&gt;</text:span>
<text:span text:style-name="Variable">preprocessed untrusted content</text:span>
<text:span text:style-name="T4">&lt;/xmp&gt;</text:span>
<text:line-break/>&lt;script type='text/javascript'&gt;NeatHtml.DefaultFilter.ProcessUntrusted();&lt;/script&gt;</text:p>
<text:p text:style-name="Text_20_body">This appears to work in most browsers, including Safari and Konqueror. <text:s/>However, the XMP element is not part of the HTML4 standard. <text:s/>So future browsers might not support it and might even ignore the XMP tags and parse the untrusted content as HTML. <text:s/>Also, strictly speaking, even earlier versions of HTML specified that the string “&lt;/” was not allowed inside the XMP element. <text:s/>Luckily most browsers seem to ignore that part of the specification and treat everything until the “&lt;/xmp&gt;” as plain text.</text:p>
<text:p text:style-name="Text_20_body">NeatHtml dynamically chooses which of the above techniques to use. <text:s/>The server prepends a test comment followed by script which calls NeatHtml's BeginUntrusted() method. <text:s/>That method checks whether the comment is accessible. <text:s/>If it is, the script injects “&lt;!--” using document.writeln(). <text:s/>If comments are not accessible, the script injects “&lt;xmp&gt;”. <text:s/>The server replaces both “--” and “&lt;/xmp&gt;” in the untrusted content and follows the content with the string “&lt;!‑‑ &gt; ‑‑&gt;&lt;xmp&gt;&lt;/xmp&gt;”, like this:</text:p>
<text:p text:style-name="CodeExample">
<text:span text:style-name="T4">&lt;!-- test comment --&gt;<text:line-break/>&lt;script type='text/javascript'&gt;NeatHtml.DefaultFilter.BeginUntrusted();&lt;/script&gt;</text:span>
<text:line-break/>
<text:span text:style-name="Variable">preprocessed untrusted content</text:span>
<text:line-break/>
<text:span text:style-name="T4">&lt;!-- &gt; --&gt;&lt;xmp&gt;&lt;/xmp&gt;</text:span>
<text:line-break/>&lt;script type='text/javascript'&gt;NeatHtml.DefaultFilter.ProcessUntrusted();&lt;/script&gt;</text:p>
<text:p text:style-name="Text_20_body">The string “&lt;!‑‑ &gt; ‑‑&gt;&lt;xmp&gt;&lt;/xmp&gt;” is designed to close either an open comment or an open XMP element. <text:s/>The “&gt;” in the comment is needed because many browsers interpret “--” as ending a comment but allow a new comment to be started if another “--” occurs before the tag is closed with an “&gt;”.</text:p>
<text:p text:style-name="Text_20_body">Note that a major advantage of using JavaScript to inject the HTML that hides the untrusted content, is that the untrusted content is <text:span text:style-name="T3">not</text:span> hidden from no-script users. <text:s/>They will see the untrusted content in the normal document flow. <text:s/>Of course this means that it is important to do additional server-side preprocessing to prevent attacks on no-script users. <text:s/>That is described in a later section.</text:p>
<text:p text:style-name="Text_20_body">Dynamically choosing which way to hide the untrusted content makes it a little harder for ProcessUntrusted() to find it. <text:s/>To assist with this, BeginUntrusted() notes the script element that called it so that ProcessUntrusted() can extract the untrusted content from the following node (i.e. the comment or XMP element). <text:s/>Also, the server adds a sentinel string after the untrusted content so that ProcessUntrusted() can determine where the untrusted content ends and doesn't have to worry about the portion of “&lt;!‑‑ &gt; ‑‑&gt;&lt;xmp&gt;&lt;/xmp&gt;” which is not applicable for the hiding method being used. <text:s/>Any string which would not generally occur in benign content will work as a sentinel string. <text:s/>The sentinel string that NeatHtml uses is highlighted below. <text:s/>It is designed to have additional advantages for no-script users which will be described later.</text:p>
<text:p text:style-name="CodeExample">&lt;!-- test comment --&gt;<text:line-break/>&lt;script type='text/javascript'&gt;NeatHtml.DefaultFilter.BeginUntrusted();&lt;/script&gt;<text:line-break/>
<text:span text:style-name="Variable">preprocessed untrusted content<text:line-break/>
</text:span>
<text:span text:style-name="T5">&lt;NeatHtmlEndUntrusted s='' d=""&gt;&lt;/NeatHtmlEndUntrusted&gt;</text:span>
<text:line-break/>&lt;!-- &gt; --&gt;&lt;xmp&gt;&lt;/xmp&gt;<text:line-break/>&lt;script type='text/javascript'&gt;NeatHtml.DefaultFilter.ProcessUntrusted();&lt;/script&gt;</text:p>
<text:p text:style-name="Text_20_body">Once ProcessUntrusted() has obtained the preprocessed untrusted content and undone the server's preprocessing, it needs to filter the untrusted content. <text:s/>
</text:p>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Preventing Phishing and Containing Vandalism with Layout Lockdown</text:h>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Defending No-Script Users with RegEx Replacements, a Table Trap, and Layout Lockdown</text:h>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Preventing Some Zero-Click XSRF by Replacing Suspicious Elements and Styles Attributes</text:h>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Preventing Phishing and Containing Vandalism with a Table Trap and Layout Lockdown</text:h>
<text:h text:style-name="Heading_20_3" text:outline-level="3">Future Research</text:h>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Allowing Restricted Scripts</text:h>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Inline Untrusted Content</text:h>
<text:h text:style-name="Heading_20_4" text:outline-level="4">Preventing One-Click XSRF</text:h>
<text:p text:style-name="Text_20_body">
<text:a xlink:type="simple" xlink:href="http://tools.ietf.org/html/rfc2965">RFC 2965</text:a> says cookies must not be sent on cross-domain redirects. <text:s/>If browsers actually follow that rule, we can prevent one-click XSRF that relies on cookies by changing URLs to go through a redirector.</text:p>
<text:p text:style-name="Text_20_body">If you don't want the gory details, you can <text:a xlink:type="simple" xlink:href="#Example">skip to the examples</text:a> to see what it can do. Otherwise, here's how it works:</text:p>
<text:list text:style-name="L3">
<text:list-item>
<text:p text:style-name="P4">Enclose the untrusted content in a &lt;table&gt; cell. Now the only way for the untrusted content to get it's content out of the table (or trusted content into its table) is by closing the table (or starting a new one). To prevent that the server could just delete all table start and end tags from the untrusted content. Of course, then legitimate tables can't be used in untrusted content at all. In many applications, that is acceptable. In applications where tables are needed, a <text:a xlink:type="simple" xlink:href="#Limitations">limited</text:a> solution is to do the following replacements:</text:p>
</text:list-item>
</text:list>
<table:table table:name="Table1" table:style-name="Table1">
<table:table-column table:style-name="Table1.A"/>
<table:table-column table:style-name="Table1.B"/>
<table:table-row>
<table:table-cell table:style-name="Table1.A1" office:value-type="string">
<text:p text:style-name="Table_20_Heading">Regular Expression</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table1.B1" office:value-type="string">
<text:p text:style-name="Table_20_Heading">Replacement</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table1.A2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;table</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table1.B2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;NeatHtmlParserReset single='' double=""&gt;&lt;/NeatHtmlParserReset&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;table</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table1.A2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;/table</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table1.B2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;NeatHtmlParserReset single='' double=""&gt;&lt;/table&gt;&lt;table&gt;&lt;tr&gt;&lt;td</text:p>
</table:table-cell>
</table:table-row>
</table:table>
<text:list text:style-name="L3" text:continue-numbering="true">
<text:list-header>
<text:p text:style-name="P4">
<text:line-break/>The NeatHtmlParserReset tag is designed to reset the browser's HTML parser to a sane state, so that an attacker can't trick the browser into skipping table tags by doing something like "&lt;tag &lt;table" or "&lt;tag attr='&lt;table". It also serves as a marker that some javascript can later use to indentify these replacements and undo them. </text:p>
</text:list-header>
<text:list-item>
<text:p text:style-name="P4">Put a div around the table, and style it to ensure that the content in the table can't use styles to display something "outside the box". These first 2 steps are sufficient to protect non-javascript users. </text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P4">Use document.write() to inject some special markup just before the untrusted content. The injected markup is chosen to cause the browser's parser to not treat subsequent text as markup. For most browsers, inject "&lt;!--" to start a comment. On browsers where the DOM doesn't provide access to the contents of comments (e.g. Safari and Konqueror), inject "&lt;xmp&gt;" instead (which for historical reasons stops processing normal markup). </text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P4">Put the close tags that correspond to our injected markup after the untrusted content. To prevent the untrusted content from escaping the javascript-injected jail, the server needs to replace "--" with "&amp;#45;&amp;#45;", "&lt;xmp" with "&amp;lt;xmp", and "&lt;/xmp" with "&amp;lt;/xmp". The server should also remove any HTML comments before doing those replacements. They aren't a security threat, but they will corrupt the display of the untrusted content. If the app that doesn't expect benign content to contain comments, it does not need to strip comments because only malicious content will be corrupted. </text:p>
</text:list-item>
<text:list-item>
<text:p text:style-name="P5">Use javascript and the DOM to extract the untrusted content, filter it, and replace our javscript-injected jail with the result. The filter converts the untrusted "tag soup" content into safe well-formed HTML. It can be configured to allow, prohibit, or modify, any element, attribute, or style. The default configuration is designed to prohibit Cross Site Scripting (XSS) attacks and other similar attacks. To ensure that "tag soup" is displayed properly and to maximize cross-browser compatibility, the filter uses a regex based parser instead of using the XML parser available in many browsers. </text:p>
</text:list-item>
</text:list>
<text:h text:style-name="Heading_20_3" text:outline-level="3" text:is-list-header="true">String Replacements</text:h>
<text:p text:style-name="Text_20_body">
<text:bookmark text:name="Replacements"/>Below is a full list of the string replacements that the server needs to do. </text:p>
<text:p text:style-name="Text_20_body">NOTE: All replacements must be <text:span text:style-name="T6">case-insensitive</text:span> and <text:span text:style-name="T6">global</text:span>. Also be sure to <text:span text:style-name="T6">escape your quotes and slashes</text:span> as appropriate for your environment. </text:p>
<table:table table:name="Table2" table:style-name="Table2">
<table:table-column table:style-name="Table2.A"/>
<table:table-column table:style-name="Table2.B"/>
<table:table-column table:style-name="Table2.C"/>
<table:table-row>
<table:table-cell table:style-name="Table2.A1" office:value-type="string">
<text:p text:style-name="Table_20_Heading">Regular Expression</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table2.A1" office:value-type="string">
<text:p text:style-name="Table_20_Heading">Replacement</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table2.C1" office:value-type="string">
<text:p text:style-name="Table_20_Heading">Notes</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:number-columns-spanned="2">
<table:table table:is-sub-table="true">
<table:table-column table:style-name="Table2.A"/>
<table:table-column table:style-name="Table2.B"/>
<table:table-row>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;table</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;NeatHtmlParserReset single='' double=""&gt;&lt;/NeatHtmlParserReset&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;table</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;/table</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;NeatHtmlParserReset single='' double=""&gt;&lt;/table&gt;&lt;table style='border-spacing: 0;'&gt;&lt;tr&gt;&lt;td style='padding: 0;'</text:p>
</table:table-cell>
</table:table-row>
</table:table>
</table:table-cell>
<table:covered-table-cell/>
<table:table-cell table:style-name="Table2.C2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">Prevents intermingling of untrusted and trusted markup.</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;!--([^-]*-)+-[^&gt;]*&gt;</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="P6"/>
</table:table-cell>
<table:table-cell table:style-name="Table2.C2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">Optional HTML comment stripping. Does not affect security. Only affects usability if benign content is expected to contain HTML comments.</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">--</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&amp;#45;&amp;#45;</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table2.C2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">Prevents escape from jail injected by javascript on most browsers. If stripping comments, strip them before doing this replacement.</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:number-columns-spanned="2">
<table:table table:is-sub-table="true">
<table:table-column table:style-name="Table2.A"/>
<table:table-column table:style-name="Table2.B"/>
<table:table-row>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;/xmp</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&amp;lt;/xmp</text:p>
</table:table-cell>
</table:table-row>
<table:table-row>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&lt;xmp</text:p>
</table:table-cell>
<table:table-cell table:style-name="Table2.A2.1.1" office:value-type="string">
<text:p text:style-name="Table_20_Contents">&amp;lt;xmp</text:p>
</table:table-cell>
</table:table-row>
</table:table>
</table:table-cell>
<table:covered-table-cell/>
<table:table-cell table:style-name="Table2.C2" office:value-type="string">
<text:p text:style-name="Table_20_Contents">Prevents escape from jail injected by javascript on browsers that don't provide DOM access to comments (e.g. Safari and Konqueror).</text:p>
</table:table-cell>
</table:table-row>
</table:table>
<text:p text:style-name="Text_20_body">In many programming environments it is possible to specify a function to be called for each regular expression match, and the function is passed information about which parts of the regular expression matched. In such an environment, you can combine the above regular expressions so that the untrusted content only needs to be scanned once on the server. </text:p>
<text:h text:style-name="Heading_20_2" text:outline-level="2">
<text:line-break/>
<text:tab/>
</text:h>
</office:text>
</office:body>
</office:document>
